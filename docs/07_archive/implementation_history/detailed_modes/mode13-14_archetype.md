# モード13・14 アーキタイプ分析実装完了サマリー

## 実装日
2025-11-29

---

## 1. 概要

モード11（Future Power分析：セグメント×ブランド）とモード12（Future Power分析：ブランド×セグメント）を参考に、以下の2つの新しいアーキタイプ分析モードを実装しました。

### 1.1 実装したモード

#### モード13: アーキタイプ分析（セグメント: X=アーキタイプ×ブランド）
- **モードID**: `archetype_segment_brands`
- **用途**: 単一セグメント内で複数ブランドのアーキタイプを比較
- **特徴**: ブランドパーソナリティを12タイプで評価

#### モード14: アーキタイプ分析（ブランド: X=アーキタイプ×セグメント）
- **モードID**: `archetype_brand_segments`
- **用途**: 単一ブランドにおける複数セグメント間のアーキタイプを比較
- **特徴**: セグメント別のブランド認識を12タイプで評価

---

## 2. 実装内容

### 2.1 型定義の拡張

#### ファイル: `types.ts`（ルート）
- ✅ `ArchetypeMetrics` インターフェースを追加（12タイプのアーキタイプ）
- ✅ `AllMetrics` 型にアーキタイプメトリクスを追加
- ✅ `ItemSet` 型に `'archetype'` を追加
- ✅ `AnalysisMode` 型に2つの新モードを追加
- ✅ `ARCHETYPE_LABELS` 定数を追加
- ✅ `ARCHETYPE_KEYS` 配列を追加
- ✅ `getItemKeysForSet()` にアーキタイプケースを追加
- ✅ `getItemLabelsForSet()` にアーキタイプケースを追加

#### ファイル: `src/types/metrics.ts`
- ✅ `ArchetypeMetrics` インターフェースを追加
- ✅ `AllMetrics` 型を更新
- ✅ `ARCHETYPE_LABELS` と `ARCHETYPE_KEYS` を追加

#### ファイル: `src/types/analysis.ts`
- ✅ `AnalysisMode` 型に2つの新モードを追加
- ✅ `ItemSet` 型に `'archetype'` を追加

#### ファイル: `src/types/index.ts`
- ✅ `ArchetypeMetrics` をエクスポート
- ✅ `ARCHETYPE_LABELS` と `ARCHETYPE_KEYS` をエクスポート
- ✅ ヘルパー関数を更新

### 2.2 アーキタイプ定義設定

#### ファイル: `src/constants/archetypeConfigs.ts`（新規作成）
- ✅ `ArchetypeDefinition` インターフェース定義
- ✅ `ARCHETYPE_DEFINITIONS` オブジェクト：12タイプの詳細定義
  - 創造者（Creator）：5項目
  - 統治者（Ruler）：4項目
  - 賢者（Sage）：5項目
  - 探検家（Explorer）：5項目
  - 幼子（Innocent）：5項目
  - 無法者（Outlaw）：4項目
  - 魔術師（Magician）：5項目
  - 英雄（Hero）：5項目
  - 恋人（Lover）：3項目
  - 道化師（Jester）：5項目
  - 仲間（Regular Guy/Gal）：4項目
  - 援助者（Caregiver）：5項目
- ✅ `ARCHETYPE_ORDER` 配列：表示順序の定義

### 2.3 モード設定の追加

#### ファイル: `constants/analysisConfigs.ts`
- ✅ モード13の設定を追加
  - X軸: 12タイプのアーキタイプ（固定）
  - データ系列: 複数ブランド
  - フィルタ: 単一セグメント
  - デフォルトチャート: レーダーチャート

- ✅ モード14の設定を追加
  - X軸: 12タイプのアーキタイプ（固定）
  - データ系列: 複数セグメント
  - フィルタ: 単一ブランド
  - デフォルトチャート: レーダーチャート

- ✅ `ANALYSIS_MODE_ORDER` 配列に2つの新モードを追加

### 2.4 アーキタイプ計算ロジック

#### ファイル: `src/utils/archetypeCalculator.ts`（新規作成）
- ✅ `calculateArchetypeMetrics()` 関数
  - ブランドイメージメトリクスから12タイプのアーキタイプ値を計算
  - 各アーキタイプは対応する項目の平均値として算出
  
- ✅ `formatArchetypeValue()` 関数
  - アーキタイプ値のフォーマット（小数点2桁）
  
- ✅ `validateArchetypeMetrics()` 関数
  - アーキタイプメトリクスの検証

### 2.5 データパース処理への統合

#### ファイル: `src/services/excelParser/ExcelParser.ts`
- ✅ `calculateArchetypeMetrics` のインポート追加
- ✅ `parseSheet()` メソッドを更新
  - ブランドイメージ値の読み込み後、アーキタイプメトリクスを自動計算
  - 計算結果を `metrics.archetypeMetrics` に格納

#### ファイル: `utils/dataTransforms.ts`
- ✅ `extractValue()` 関数を更新
  - アーキタイプメトリクスの特別処理を追加
  - `itemSet === 'archetype'` の場合、ネストされた `archetypeMetrics` から値を取得

---

## 3. データフロー

### 3.1 Excelファイルの読み込み
1. **ブランドイメージ項目の読み込み**（AP列～DE列、68項目）
2. **アーキタイプメトリクスの自動計算**
   - 各アーキタイプの定義に基づき、対応する項目の平均値を算出
3. **メトリクスへの格納**
   - `AllMetrics.archetypeMetrics` に12タイプの値を格納

### 3.2 チャート表示
1. **モード選択**: モード13またはモード14を選択
2. **軸設定**: セグメント/ブランドを選択
3. **データ変換**: `dataTransforms.ts` でアーキタイプデータを抽出
4. **チャート描画**: レーダーチャートで12タイプを表示

---

## 4. ドキュメント

### 4.1 作成したドキュメント

#### `docs/mode13_archetype_segment_brands_requirements.md`
- モード13の要件定義書
- アーキタイプの詳細説明
- 計算方法と使用例
- 技術仕様

#### `docs/mode14_archetype_brand_segments_requirements.md`
- モード14の要件定義書
- モード12との差分説明
- UI/UX仕様
- ビジネス価値と使用例

#### `docs/mode13_mode14_implementation_summary.md`（本ファイル）
- 実装完了サマリー
- 全体構成と変更箇所の一覧
- データフローの説明

---

## 5. 実装の特徴

### 5.1 モード11・12との類似性

モード11・12の構造を参考にすることで、効率的な実装を実現：

| 要素 | モード11/12 | モード13/14 |
|------|-----------|-----------|
| **データ源** | Excel直接読み込み | ブランドイメージから計算 |
| **指標数** | 6項目（FP1-FP6） | 12項目（12タイプ） |
| **型定義** | FuturePowerMetrics | ArchetypeMetrics |
| **itemSet** | 'futurePower' | 'archetype' |
| **計算方法** | セル値をそのまま使用 | 複数項目の平均値 |

### 5.2 自動計算の仕組み

アーキタイプは、ブランドイメージ項目から自動的に算出：

```typescript
// 例: 創造者（Creator）の計算
const creatorItems = [
  '新しい価値を提案する',
  '先見性のある',
  '独創性がある',
  '知的な',
  '信念・ポリシーのある'
];

const values = creatorItems.map(item => imageMetrics[item]);
const creator = values.reduce((sum, val) => sum + val, 0) / values.length;
```

### 5.3 レーダーチャートでの視覚化

12タイプのアーキタイプをレーダーチャートで表示することで：
- ブランドパーソナリティの全体像を直感的に把握
- 複数ブランド/セグメントの比較が容易
- 特徴的な形状として記憶に残りやすい

---

## 6. ビジネス価値

### 6.1 モード13の活用

**セグメント内でブランドを比較**
- 競合ブランドとのパーソナリティの違いを明確化
- 差別化ポイントの特定
- ブランドポジショニング戦略の立案

### 6.2 モード14の活用

**ブランド内でセグメントを比較**
- セグメント別のブランド認識の違いを把握
- ターゲットセグメントの選定
- セグメント別コミュニケーション戦略の最適化

### 6.3 両モードの併用

モード13とモード14を併用することで：
- ブランドの強みと弱みを多角的に評価
- セグメント戦略とブランド戦略の統合
- より精緻なマーケティング戦略の立案

---

## 7. 技術的な工夫

### 7.1 既存コードの再利用

- モード11・12の構造を踏襲
- ExcelParserの既存ロジックを活用
- dataTransformsの既存フレームワークに統合

### 7.2 型安全性の確保

- TypeScriptの型システムを活用
- すべてのアーキタイプにキー定義
- ヘルパー関数で型チェック

### 7.3 保守性の向上

- アーキタイプ定義を一箇所に集約（archetypeConfigs.ts）
- 計算ロジックを独立したユーティリティとして実装
- ドキュメントの充実

---

## 8. 今後の拡張性

### 8.1 カスタムアーキタイプ

将来的な拡張として、ユーザー定義のアーキタイプを追加可能：
- 独自のブランドイメージ項目の組み合わせ
- 業界特有のパーソナリティ評価

### 8.2 時系列分析

過去データとの比較機能の追加可能性：
- アーキタイプの変化をトラッキング
- リブランディング効果の測定

### 8.3 高度な分析

より高度な分析機能の追加可能性：
- アーキタイプ同士の相関分析
- クラスター分析によるブランドグループ化
- アーキタイプと売上の関係分析

---

## 9. 検証項目

実装完了後、以下の項目を確認：

### 9.1 基本動作
- [ ] Excelファイルの正常読み込み
- [ ] アーキタイプメトリクスの正確な計算
- [ ] モード13・14の選択と切り替え
- [ ] レーダーチャートの正常表示

### 9.2 UI/UX
- [ ] セグメント/ブランドの選択
- [ ] 複数選択とドラッグ&ドロップ
- [ ] チャートタイプの切り替え
- [ ] データラベルの表示/非表示

### 9.3 データ出力
- [ ] CSV出力の動作
- [ ] PNG画像コピーの動作
- [ ] データテーブルの表示

### 9.4 エッジケース
- [ ] 欠損値の処理
- [ ] 項目が存在しない場合の処理
- [ ] 計算不可能な場合のエラーハンドリング

---

## 10. まとめ

### 10.1 達成事項
✅ モード13（セグメント×ブランド）の完全実装  
✅ モード14（ブランド×セグメント）の完全実装  
✅ 12タイプのアーキタイプ定義と自動計算  
✅ 既存システムへのシームレスな統合  
✅ 包括的なドキュメント作成  

### 10.2 技術的成果
- 型安全な実装
- 保守性の高いコード構造
- 既存コードの効率的な再利用
- 拡張性の確保

### 10.3 ビジネス価値
- ブランドパーソナリティの定量的評価
- 競合分析とポジショニング戦略の支援
- セグメント戦略の最適化
- データドリブンなマーケティング意思決定の実現

---

**実装ステータス**: 完了  
**実装日**: 2025-11-29  
**バージョン**: 1.0  
**次のステップ**: 動作確認とテスト

