# モード8 - ブランドイメージ分析（ブランド×複数セグメント）要件定義書

## 最終更新
2025-11-29

---

## 1. 概要

### 1.1 モード名
**モード8**: ブランドイメージ分析（ブランド: X=ブランドイメージ×セグメント）

### 1.2 モードID
`brand_image_brand_segments`

### 1.3 目的
特定のブランドにおいて、複数のセグメント間で**ブランドイメージ指標（全133項目）**の中から上位30項目を抽出し、セグメント間のイメージの違いを比較する。

### 1.4 参照モード
**モード7**（`brand_image_segment_brands`）: ブランドイメージ分析（セグメント固定×複数ブランド）

### 1.5 モード7との差分
| 項目 | モード7（セグメント固定） | モード8（ブランド固定） |
|------|-------------------------|------------------------|
| **モードID** | `brand_image_segment_brands` | `brand_image_brand_segments` |
| **固定軸** | 単一セグメント | 単一ブランド |
| **比較軸** | 複数ブランド | 複数セグメント |
| **分析視点** | 「セグメント内でブランドを比較」 | 「ブランド内でセグメントを比較」 |
| **主な用途** | ブランド間のイメージ比較 | セグメント間のイメージ比較 |
| **基準** | 基準ブランド（先頭ブランド） | 基準セグメント（先頭セグメント） |

---

## 2. ブランドイメージ指標

### 2.1 指標概要
- **総数**: 133項目
- **Excel列範囲**: AP列～FS列（列インデックス41～174）
- **データソース**: Excelシートの各列に1つのイメージ項目が対応
- **TOP30選定**: 基準セグメント（選択セグメントの先頭）での基準ブランドの数値降順で上位30項目を自動選定

### 2.2 データの特性
- **項目例**: 「信頼できる」「高品質な」「革新的な」「伝統的な」など
- **除外項目**: 「あてはまるものはない」は自動的に除外
- **自動選定**: ユーザーが項目を選択する必要はなく、システムが自動的に選定

### 2.3 TOP30選定ロジック
1. **基準セグメントの決定**: 選択セグメントリストの先頭（一番上）のセグメント
2. **基準ブランドのデータ取得**: 選択したブランドの、基準セグメントでのデータを取得
3. **数値降順ソート**: 基準ブランドの全イメージ項目を数値の高い順にソート
4. **TOP30抽出**: 上位30項目を抽出
5. **他セグメントへの適用**: 抽出した30項目を、他の選択セグメントにも適用

---

## 3. 分析モード詳細

### 3.1 分析軸の構成
- **X軸**: ブランドイメージ項目（自動選定、TOP30）
- **データ系列**: 選択した複数のセグメント
- **フィルタ**: ブランド（単一選択）

### 3.2 UI要素
- **分析項目セクション**: 【固定】バッジ表示、UI非表示（自動選定のため）
- **セグメントセクション**: 【MA】バッジ表示、複数選択リスト + ドラッグ＆ドロップ
- **ブランドセクション**: 【SA】バッジ表示、ドロップダウン選択

### 3.3 デフォルトチャートタイプ
**集合縦棒グラフ**

**理由**:
- 30項目の比較に適している
- 複数セグメントの比較が容易
- X軸ラベルを縦方向に配置することで、項目名の可読性を確保

### 3.4 X軸ラベルの表示
- **方向**: 縦方向（90度回転）
- **理由**: 項目数が多いため、横方向では重なってしまう
- **特記事項**: レーダーチャートに切り替えた場合も、項目名が適切に表示される

---

## 4. データ要件

### 4.1 Excelファイルのフォーマット

#### 必要な列
| 列 | 列インデックス (0-based) | Excel列 | 説明 |
|--------|------------------|------------|------|
| ブランド名 | 3 | D | ブランド識別子（固定位置） |
| イメージ項目 | **動的検出** | **可変** | ブランドイメージ項目（パターンマッチングで抽出） |

#### データ形式
- **カテゴリ行**: 1行目（各列のカテゴリ名）
- **項目名行**: 2行目（各列の項目名、「ブランドイメージ」を含む列を検索）
- **ヘッダー行**: 3行目（各列の詳細項目名、実際のヘッダーとして使用）
- **データ開始**: 4行目以降
- **データ型**: 数値（パーセンテージ）
- **欠損値処理**: 「-」または空白は自動的に0として処理

#### ブランドイメージ項目の抽出方法
ブランドイメージ項目は、**パターンマッチング方式**で動的に抽出されます：

1. **行1（2行目）をスキャン**: 各列の項目名に「ブランドイメージ」が含まれるかチェック
2. **除外キーワードチェック**: 「あてはまるものはない」を含む項目は除外
3. **ヘッダー名の取得**: 行2（3行目）から実際の項目名を取得
4. **列インデックスの記録**: 検出された列のインデックスを記録

**メリット**:
- ✅ 列位置に依存しない柔軟な抽出
- ✅ ファイルごとに列数が異なっても自動的に対応可能
- ✅ 将来のファイル形式変更にも対応可能

> **注意**: 従来の固定列範囲（41-174列）方式から、パターンマッチング方式に変更されました。これにより、ファイルごとに列数が異なる場合でも（例：202406ファイルは207列、202506ファイルは195列）自動的に対応できます。

---

## 5. 実装仕様

### 5.1 モード設定（constants/analysisConfigs.ts）

```typescript
'brand_image_brand_segments': {
  id: 'brand_image_brand_segments',
  name: 'ブランドイメージ分析（ブランド: X=ブランドイメージ×セグメント）',
  description: '単一ブランドにおける複数セグメントのブランドイメージ指標を比較',
  axes: {
    items: {
      role: 'X_AXIS',
      label: '分析項目',
      allowMultiple: false,
      itemSet: 'brandImage',
      fixedItems: [],  // 動的に決定されるため空
      autoSelect: true,  // 自動選定機能を有効化
      autoSelectCount: 30  // TOP30を選定
    },
    segments: {
      role: 'SERIES',
      label: 'セグメント比較',
      allowMultiple: true
    },
    brands: {
      role: 'FILTER',
      label: 'ブランド選択',
      allowMultiple: false
    }
  },
  dataTransform: {
    xAxis: 'items',
    series: 'segments',
    filter: 'brands'
  },
  defaultChartType: 'bar'
}
```

### 5.2 型定義（types.ts）

**既存の型定義を流用**:
- `ItemSet` 型の `'brandImage'`（モード7で追加済み）

### 5.3 データパース処理（App.tsx）

**既存の実装を流用**:
モード7で実装済みの以下の処理を活用：
- ブランドイメージ項目の動的な検出
- イメージメトリクスの読み込み
- TOP30選定ロジック

**モード8特有の実装**:
```typescript
// モード8のTOP30選定ロジック（基準セグメントを使用）
function selectTop30ItemsForMode8(
  data: { [segmentName: string]: SegmentData },
  selectedBrand: string,
  referenceSegment: string
): string[] {
  const segmentData = data[referenceSegment];
  if (!segmentData) return [];
  
  const brandData = segmentData.brands.find(b => b.name === selectedBrand);
  if (!brandData) return [];
  
  const sortedItems = Object.entries(brandData.imageMetrics || {})
    .sort((a, b) => b[1] - a[1])  // 降順ソート
    .slice(0, 30)  // 上位30項目
    .map(entry => entry[0]);
  
  return sortedItems;
}
```

---

## 6. ビジネス価値

### 6.1 分析の目的
1. **セグメント別イメージ評価**: 特定ブランドが各セグメントでどのようなイメージを持たれているか評価
2. **セグメント間のギャップ把握**: イメージの強いセグメントと弱いセグメントを可視化
3. **セグメント特化型イメージ戦略**: セグメント別のイメージ戦略を立案

### 6.2 想定ユースケース

#### ユースケース1: セグメント別イメージ分析
**シナリオ**: 自社ブランドAのイメージを若年層・中年層・シニア層で比較

- **操作**: モード8選択 → ブランドA選択 → 3セグメント選択
- **発見**: 若年層では「革新的」「先進的」が強いが、シニア層では「信頼できる」「安定感」が強い
- **アクション**: セグメント別のコミュニケーション戦略を見直す

#### ユースケース2: 地域別イメージの違い
**シナリオ**: ブランドBのイメージを地域別に比較

- **操作**: モード8選択 → ブランドB選択 → 地域セグメント4つ選択
- **発見**: 関東では「高級感」が強いが、地方では「親しみやすさ」が強い
- **アクション**: 地域別の広告戦略を最適化

#### ユースケース3: モード7との併用分析
**シナリオ**: ブランド間比較（モード7）とセグメント間比較（モード8）を併用

- **操作**:
  1. モード7で「全体セグメント」における3ブランドのイメージ比較
  2. モード8で「ブランドA」における3セグメントのイメージ比較
- **発見**: ブランドAは全体では強いが、特定セグメントでは弱い
- **アクション**: セグメント特化型のイメージ戦略を立案

---

## 7. 使用例

### シナリオ1: 性年代別のイメージ分析

**目的**: 自社ブランドが各性年代でどのようなイメージを持たれているか把握

**手順**:
1. モード8「ブランドイメージ分析（ブランド×複数セグメント）」を選択
2. ブランド「自社ブランド」を選択
3. セグメント「男性20代」「男性30代」「女性20代」「女性30代」を選択（最初のセグメントが基準となる）
4. 集合縦棒グラフでTOP30項目の比較を確認

**分析ポイント**:
- どの性年代でどのイメージが強いか？
- セグメント間でイメージの違いは大きいか？
- どのイメージが共通して強い/弱いか？

### シナリオ2: 地域別のイメージ分析

**目的**: 自社ブランドの地域別のイメージの違いを把握

**手順**:
1. モード8を選択
2. ブランド「自社ブランド」を選択
3. セグメント「関東」「関西」「中部」「九州」を選択
4. レーダーチャートに切り替えて全体像を確認

**分析ポイント**:
- どの地域でどのイメージが強いか？
- 地域間でイメージの違いは大きいか？
- どのイメージが共通して強い/弱いか？

---

## 8. 注意事項

### 8.1 データの解釈
1. **基準セグメントの重要性**
   - 選択セグメントの先頭（一番上）が基準セグメントとなる
   - 基準セグメントでの基準ブランドのTOP30項目が、他のセグメントにも適用される
   - 基準セグメントを変更すると、TOP30項目が変わる可能性がある

2. **TOP30の選定基準**
   - 基準セグメントでの基準ブランドの数値が高い順に30項目を選定
   - 「あてはまるものはない」は自動的に除外
   - 30項目未満の場合は、すべての項目が表示される

3. **セグメント間の数値差異**
   - セグメントによってイメージの強さが異なるため、絶対値よりも相対的な傾向を重視

### 8.2 グラフの読み方
- **X軸**: ブランドイメージ項目（TOP30）
- **縦棒の高さ**: 各項目の数値
- **色分け**: セグメントごとに異なる色
- **並び順**: ドラッグ&ドロップでセグメントの順序を調整可能

### 8.3 基準セグメントの警告表示
アプリケーションでは、基準セグメントがどれであるかを明確に表示する警告バッジが表示される：
- 「基準: 〇〇〇」のような形式
- セグメント並び順を変更すると、基準セグメントも変更される

---

## 9. 他のモードとの使い分け

### モード7とモード8の使い分け
| 観点 | モード7（セグメント固定） | モード8（ブランド固定） |
|------|-------------------------|------------------------|
| **固定軸** | セグメント（単一） | ブランド（単一） |
| **比較軸** | 複数ブランド | 複数セグメント |
| **主な用途** | ブランド間のイメージ比較 | セグメント間のイメージ比較 |
| **発見内容** | ブランドのイメージポジショニング | セグメント別のイメージの違い |
| **基準** | 基準ブランド | 基準セグメント |

### モード2とモード8の使い分け
| 観点 | モード2（ファネル分析） | モード8（イメージ分析） |
|------|------------------------|----------------------|
| **分析対象** | 認知から購入までの段階 | ブランドイメージ |
| **指標数** | 6項目（固定） | 30項目（自動選定） |
| **主な用途** | セグメント別ファネル分析 | セグメント別イメージ分析 |

---

## 10. 実装上の注意点

### 10.1 モード7との完全な対称性
モード7（セグメント固定）とモード8（ブランド固定）は、固定軸と比較軸が異なるだけで構造は完全に同じ：

| 要素 | モード7 | モード8 |
|------|---------|---------|
| フィルタ軸 | 単一セグメント | 単一ブランド |
| データ系列軸 | 複数ブランド | 複数セグメント |
| X軸 | イメージTOP30（共通） | イメージTOP30（共通） |
| 基準 | 基準ブランド | 基準セグメント |

### 10.2 動的な項目選定
- イメージ項目は固定ではなく、動的に選定される
- `fixedItems: []` として空配列を指定
- `autoSelect: true` および `autoSelectCount: 30` を設定

### 10.3 X軸ラベルの縦方向表示
- 項目数が多いため、X軸ラベルは縦方向（90度回転）で表示
- CSSまたはRechartsの設定で実装

### 10.4 実装の効率化
モード7の実装をコピーし、以下の箇所のみ変更すればOK：
1. モードID: `brand_image_segment_brands` → `brand_image_brand_segments`
2. axes.segments.role: `'FILTER'` → `'SERIES'`
3. axes.brands.role: `'SERIES'` → `'FILTER'`
4. dataTransform.series: `'brands'` → `'segments'`
5. dataTransform.filter: `'segments'` → `'brands'`
6. TOP30選定ロジックで基準セグメントを使用

---

## 11. まとめ

モード8「ブランドイメージ分析（ブランド×複数セグメント）」は、特定のブランドを複数のセグメント間でイメージ指標により比較する分析モードです。

### 主な特徴
- **133項目から自動選定**: 基準セグメントでのTOP30項目を自動抽出
- **セグメント比較**: セグメント間のイメージの違いを可視化
- **縦方向X軸ラベル**: 30項目を見やすく表示
- **柔軟な基準変更**: ドラッグ&ドロップで基準セグメントを変更可能

### 活用シーン
- セグメント別のブランドイメージ分析
- 性年代別・地域別のイメージの違いの把握
- セグメント特化型イメージ戦略の立案
- セグメント間のイメージギャップの可視化

### モード7との補完関係
- **モード7**: セグメント内でブランドを比較
- **モード8**: ブランド内でセグメントを比較
- 両方を併用することで、多角的なイメージ分析が可能

このモードを活用することで、セグメント別のブランドイメージを詳細に評価し、効果的なセグメント特化型イメージ戦略を立案できます。

---

**文書ステータス**: 要件定義完了  
**作成日**: 2025-11-29  
**バージョン**: 1.0

