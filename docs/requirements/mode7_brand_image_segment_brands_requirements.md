# モード7 - ブランドイメージ分析（セグメント×複数ブランド）要件定義書

## 最終更新
2025-11-29

---

## 1. 概要

### 1.1 モード名
**モード7**: ブランドイメージ分析（セグメント: X=ブランドイメージ×ブランド）

### 1.2 モードID
`brand_image_segment_brands`

### 1.3 目的
特定のセグメント内で、複数のブランドの**ブランドイメージ指標（全133項目）**の中から上位30項目を抽出し、ブランド間のイメージを比較する。

### 1.4 主な用途
- ブランドイメージの強み・弱みの可視化
- 競合他社とのイメージポジショニング比較
- ブランドの特徴的なイメージの把握
- イメージ戦略の方向性決定

---

## 2. ブランドイメージ指標

### 2.1 指標概要
- **総数**: 133項目
- **Excel列範囲**: AP列～FS列（列インデックス41～174）
- **データソース**: Excelシートの各列に1つのイメージ項目が対応
- **TOP30選定**: 基準ブランド（選択ブランドの先頭）の数値降順で上位30項目を自動選定

### 2.2 データの特性
- **項目例**: 「信頼できる」「高品質な」「革新的な」「伝統的な」など
- **除外項目**: 「あてはまるものはない」は自動的に除外
- **自動選定**: ユーザーが項目を選択する必要はなく、システムが自動的に選定

### 2.3 TOP30選定ロジック
1. **基準ブランドの決定**: 選択ブランドリストの先頭（一番上）のブランド
2. **数値降順ソート**: 基準ブランドの全イメージ項目を数値の高い順にソート
3. **TOP30抽出**: 上位30項目を抽出
4. **他ブランドへの適用**: 抽出した30項目を、他の選択ブランドにも適用

---

## 3. 分析モード詳細

### 3.1 分析軸の構成
- **X軸**: ブランドイメージ項目（自動選定、TOP30）
- **データ系列**: 選択した複数のブランド
- **フィルタ**: セグメント（単一選択）

### 3.2 UI要素
- **分析項目セクション**: 【固定】バッジ表示、UI非表示（自動選定のため）
- **セグメントセクション**: 【SA】バッジ表示、ドロップダウン選択
- **ブランドセクション**: 【MA】バッジ表示、複数選択リスト + ドラッグ＆ドロップ

### 3.3 デフォルトチャートタイプ
**集合縦棒グラフ**

**理由**:
- 30項目の比較に適している
- 複数ブランドの比較が容易
- X軸ラベルを縦方向に配置することで、項目名の可読性を確保

### 3.4 X軸ラベルの表示
- **方向**: 縦方向（90度回転）
- **理由**: 項目数が多いため、横方向では重なってしまう
- **特記事項**: レーダーチャートに切り替えた場合も、項目名が適切に表示される

---

## 4. データ要件

### 4.1 Excelファイルのフォーマット

#### 必要な列
| 列 | 列インデックス (0-based) | Excel列 | 説明 |
|--------|------------------|------------|------|
| ブランド名 | 3 | D | ブランド識別子（固定位置） |
| イメージ項目 | **動的検出** | **可変** | ブランドイメージ項目（パターンマッチングで抽出） |

#### データ形式
- **カテゴリ行**: 1行目（各列のカテゴリ名）
- **項目名行**: 2行目（各列の項目名、「ブランドイメージ」を含む列を検索）
- **ヘッダー行**: 3行目（各列の詳細項目名、実際のヘッダーとして使用）
- **データ開始**: 4行目以降
- **データ型**: 数値（パーセンテージ）
- **欠損値処理**: 「-」または空白は自動的に0として処理

#### ブランドイメージ項目の抽出方法
ブランドイメージ項目は、**パターンマッチング方式**で動的に抽出されます：

1. **行1（2行目）をスキャン**: 各列の項目名に「ブランドイメージ」が含まれるかチェック
2. **除外キーワードチェック**: 「あてはまるものはない」を含む項目は除外
3. **ヘッダー名の取得**: 行2（3行目）から実際の項目名を取得
4. **列インデックスの記録**: 検出された列のインデックスを記録

**メリット**:
- ✅ 列位置に依存しない柔軟な抽出
- ✅ ファイルごとに列数が異なっても自動的に対応可能
- ✅ 将来のファイル形式変更にも対応可能

> **注意**: 従来の固定列範囲（41-174列）方式から、パターンマッチング方式に変更されました。これにより、ファイルごとに列数が異なる場合でも（例：202406ファイルは207列、202506ファイルは195列）自動的に対応できます。

---

## 5. 技術仕様

### 5.1 型定義（types.ts への追加）

```typescript
// Brand Image Items (動的に決定されるため、固定の型定義はなし)
// ただし、ItemSet として 'brandImage' を追加

export type ItemSet = 
  | 'funnel' 
  | 'funnel2' 
  | 'timeline' 
  | 'brandImage'  // 追加
  | 'brandPower' 
  | 'futurePower' 
  | 'custom';

export type AnalysisMode = 
  | 'segment_x_multi_brand'
  | 'brand_x_multi_segment'
  | 'item_x_multi_brand'
  | 'timeline_brand_multi_segment'
  | 'timeline_segment_multi_brand'
  | 'timeline_item_multi_brand'
  | 'brand_image_segment_brands'  // 追加
  | ...;
```

### 5.2 モード設定（constants/analysisConfigs.ts への追加）

```typescript
'brand_image_segment_brands': {
  id: 'brand_image_segment_brands',
  name: 'ブランドイメージ分析（セグメント: X=ブランドイメージ×ブランド）',
  description: '単一セグメントにおける複数ブランドのブランドイメージ指標を比較',
  axes: {
    items: {
      role: 'X_AXIS',
      label: '分析項目',
      allowMultiple: false,
      itemSet: 'brandImage',
      fixedItems: [],  // 動的に決定されるため空
      autoSelect: true,  // 自動選定機能を有効化
      autoSelectCount: 30  // TOP30を選定
    },
    segments: {
      role: 'FILTER',
      label: 'データシート',
      allowMultiple: false
    },
    brands: {
      role: 'SERIES',
      label: 'ブランド比較',
      allowMultiple: true
    }
  },
  dataTransform: {
    xAxis: 'items',
    series: 'brands',
    filter: 'segments'
  },
  defaultChartType: 'bar'
}
```

### 5.3 データパース処理（App.tsx への追加）

```typescript
// Brand Image項目の動的な検出
// AP列（インデックス41）からFS列（インデックス174）まで
const brandImageItems: { [key: string]: number } = {};

for (let idx = 41; idx <= 174; idx++) {
  const headerStr = headers[idx]?.trim().replace(/\r?\n/g, '');
  if (headerStr && headerStr !== 'あてはまるものはない') {
    brandImageItems[headerStr] = idx;
  }
}

// データ行処理でイメージ項目を読み込み
const imageMetrics: { [key: string]: number } = {};
Object.keys(brandImageItems).forEach(itemName => {
  const colIdx = brandImageItems[itemName];
  let val = row[colIdx];
  if (val === '-' || val === undefined || val === null) val = 0;
  imageMetrics[itemName] = typeof val === 'number' ? val : parseFloat(val) || 0;
});

// TOP30選定ロジック
function selectTop30Items(
  data: SegmentData,
  referenceBrand: string
): string[] {
  const brandData = data.brands.find(b => b.name === referenceBrand);
  if (!brandData) return [];
  
  const sortedItems = Object.entries(brandData.imageMetrics || {})
    .sort((a, b) => b[1] - a[1])  // 降順ソート
    .slice(0, 30)  // 上位30項目
    .map(entry => entry[0]);
  
  return sortedItems;
}
```

---

## 6. 使用例

### シナリオ1: 競合他社とのイメージ比較

**目的**: 「全体」セグメントで自社ブランドと競合2社のイメージを比較

**手順**:
1. モード7「ブランドイメージ分析（セグメント×複数ブランド）」を選択
2. セグメント「全体」を選択
3. ブランド「自社ブランド」「競合A」「競合B」を選択（自社ブランドを先頭に配置）
4. 集合縦棒グラフでTOP30項目の比較を確認

**分析ポイント**:
- 自社ブランドの強いイメージは何か？
- 競合と比較して弱いイメージは何か？
- ポジショニングの違いはどこにあるか？

### シナリオ2: ブランドポートフォリオのイメージ分析

**目的**: 自社の複数ブランドのイメージの違いを可視化

**手順**:
1. モード7を選択
2. セグメント「全体」を選択
3. 自社の複数ブランド「ブランドA」「ブランドB」「ブランドC」を選択
4. レーダーチャートに切り替えて全体像を確認

**分析ポイント**:
- 各ブランドの特徴的なイメージは何か？
- ポートフォリオ全体でのイメージの多様性
- ブランド間で重複しているイメージはあるか？

### シナリオ3: 基準ブランドの変更による比較

**目的**: 異なるブランドを基準にした場合のTOP30の違いを確認

**手順**:
1. モード7を選択
2. セグメント「全体」を選択
3. ブランド「ブランドA」「ブランドB」「ブランドC」を選択
4. ブランドの並び順をドラッグ&ドロップで変更し、異なるブランドを先頭に配置
5. TOP30項目の変化を確認

**分析ポイント**:
- ブランドによってTOP30項目がどの程度変わるか？
- 共通して重視されているイメージは何か？
- ブランド特有のイメージは何か？

---

## 7. 注意事項

### 7.1 データの解釈
1. **基準ブランドの重要性**
   - 選択ブランドの先頭（一番上）が基準ブランドとなる
   - 基準ブランドのTOP30項目が、他のブランドにも適用される
   - 基準ブランドを変更すると、TOP30項目が変わる可能性がある

2. **TOP30の選定基準**
   - 基準ブランドの数値が高い順に30項目を選定
   - 「あてはまるものはない」は自動的に除外
   - 30項目未満の場合は、すべての項目が表示される

3. **セグメントの選択**
   - 「全体」セグメントで全体傾向を把握
   - 特定セグメント（年代別、性別など）で詳細分析

### 7.2 グラフの読み方
- **X軸**: ブランドイメージ項目（TOP30）
- **縦棒の高さ**: 各項目の数値
- **色分け**: ブランドごとに異なる色
- **並び順**: ドラッグ&ドロップでブランドの順序を調整可能

### 7.3 基準ブランドの警告表示
アプリケーションでは、基準ブランドがどれであるかを明確に表示する警告バッジが表示される：
- 「基準: 〇〇〇」のような形式
- ブランド並び順を変更すると、基準ブランドも変更される

---

## 8. 他のモードとの使い分け

### モード7とモード8の使い分け
| 観点 | モード7（セグメント固定） | モード8（ブランド固定） |
|------|-------------------------|------------------------|
| **固定軸** | セグメント（単一） | ブランド（単一） |
| **比較軸** | 複数ブランド | 複数セグメント |
| **主な用途** | ブランド間のイメージ比較 | セグメント間のイメージ比較 |
| **発見内容** | ブランドのイメージポジショニング | セグメント別のイメージの違い |

### モード1とモード7の使い分け
| 観点 | モード1（ファネル分析） | モード7（イメージ分析） |
|------|------------------------|----------------------|
| **分析対象** | 認知から購入までの段階 | ブランドイメージ |
| **指標数** | 6項目（固定） | 30項目（自動選定） |
| **主な用途** | ファネル分析 | イメージポジショニング |

---

## 9. 実装上の注意点

### 9.1 動的な項目選定
- イメージ項目は固定ではなく、動的に選定される
- `fixedItems: []` として空配列を指定
- `autoSelect: true` および `autoSelectCount: 30` を設定

### 9.2 X軸ラベルの縦方向表示
- 項目数が多いため、X軸ラベルは縦方向（90度回転）で表示
- CSSまたはRechartsの設定で実装

### 9.3 基準ブランドの管理
- ブランドリストの先頭が基準ブランドとなる
- ドラッグ&ドロップでブランドの順序を変更すると、基準ブランドも変更される
- UIで基準ブランドを明示する警告バッジを表示

---

## 10. まとめ

モード7「ブランドイメージ分析（セグメント×複数ブランド）」は、特定のセグメント内で複数のブランドのイメージをTOP30項目で比較する分析モードです。

### 主な特徴
- **133項目から自動選定**: 基準ブランドのTOP30項目を自動抽出
- **ブランド比較**: ブランド間のイメージポジショニングを可視化
- **縦方向X軸ラベル**: 30項目を見やすく表示
- **柔軟な基準変更**: ドラッグ&ドロップで基準ブランドを変更可能

### 活用シーン
- 競合他社とのイメージ比較
- ブランドポートフォリオのイメージ分析
- イメージ戦略の方向性決定
- ブランドポジショニングの可視化

### 他のモードとの補完関係
- **モード1**: ファネル分析（認知～購入）
- **モード7**: イメージ分析（ブランドイメージ）
- 両方を併用することで、ファネルとイメージの両面から評価可能

このモードを活用することで、ブランドイメージを多角的に評価し、効果的なブランド戦略を立案できます。

---

**文書ステータス**: 要件定義完了  
**作成日**: 2025-11-29  
**バージョン**: 1.0

