# モード1 - ファネル分析①（セグメント×複数ブランド）要件定義書

## 最終更新
2025-11-29

---

## 1. 概要

### 1.1 モード名
**モード1**: ファネル分析①（セグメント: X=ファネル①×ブランド）

### 1.2 モードID
`segment_x_multi_brand`

### 1.3 目的
特定のセグメント内で、複数のブランドの**ファネル指標（FT-GL）**を比較し、ブランド間の認知から購入、リピートまでの顧客行動段階を評価する。

### 1.4 主な用途
- 競合他社との比較分析
- セグメント内でのブランドパフォーマンス比較
- 認知度から購入意向までの各段階でのブランド強度の把握

---

## 2. ファネル指標（FT-GL）

### 2.1 指標一覧

| 指標コード | 指標名 | Excel列 | 列インデックス | 説明 |
|:---|:---|:---|:---|:---|
| FT | 認知あり(TOP2) | M | 12 | ブランドを認知している |
| FW | 興味あり(TOP2) | P | 15 | ブランドに興味がある |
| FZ | 好意あり(TOP2) | S | 18 | ブランドに好意を持っている |
| GC | 購入・利用意向あり(TOP2) | V | 21 | 購入・利用したい |
| GJ | 購入・利用経験あり(TOP5) | AD | 29 | 購入・利用したことがある |
| GL | リピート意向あり(TOP2) | AG | 32 | また購入・利用したい |

### 2.2 各指標の詳細

#### FT: 認知あり(TOP2)
- **定義**: ブランドを認知している度合い
- **評価内容**: ブランドの知名度
- **マーケティング的意義**: ファネルの最上位層、認知拡大施策の効果測定

#### FW: 興味あり(TOP2)
- **定義**: ブランドに興味を持っている度合い
- **評価内容**: 認知から興味への転換
- **マーケティング的意義**: 興味喚起施策の効果測定

#### FZ: 好意あり(TOP2)
- **定義**: ブランドに好意を持っている度合い
- **評価内容**: ブランドへの好感度
- **マーケティング的意義**: ブランドイメージ施策の効果測定

#### GC: 購入・利用意向あり(TOP2)
- **定義**: 購入・利用したい度合い
- **評価内容**: 購入への意欲
- **マーケティング的意義**: コンバージョン施策の効果測定

#### GJ: 購入・利用経験あり(TOP5)
- **定義**: 実際に購入・利用したことがある度合い
- **評価内容**: 実際の購入経験
- **マーケティング的意義**: トライアル施策の効果測定

#### GL: リピート意向あり(TOP2)
- **定義**: また購入・利用したい度合い
- **評価内容**: リピート意欲
- **マーケティング的意義**: ロイヤリティ施策の効果測定

---

## 3. 分析モード詳細

### 3.1 分析軸の構成
- **X軸**: ファネル指標（固定6項目：FT～GL）
- **データ系列**: 選択した複数のブランド
- **フィルタ**: セグメント（単一選択）

### 3.2 UI要素
- **分析項目セクション**: 【固定】バッジ表示、UI非表示（6指標は固定のため）
- **セグメントセクション**: 【SA】バッジ表示、ドロップダウン選択
- **ブランドセクション**: 【MA】バッジ表示、複数選択リスト + ドラッグ＆ドロップ

### 3.3 デフォルトチャートタイプ
**集合縦棒グラフ**

**理由**:
- 6指標の比較が視覚的に明確
- 複数ブランドの比較が容易
- ファネル構造（減少傾向）を直感的に把握できる

---

## 4. データ要件

### 4.1 Excelファイルのフォーマット

#### 必要な列
| 列 | 列番号（0-based） | Excel列 | ヘッダー名 | 内部キー | 説明 |
|----|-----------------|---------|-----------|---------|------|
| ブランド名 | 3 | D | (任意) | - | ブランド識別子 |
| 認知あり | 12 | M | 認知あり(TOP2) | FT | ファネル指標1 |
| 興味あり | 15 | P | 興味あり(TOP2) | FW | ファネル指標2 |
| 好意あり | 18 | S | 好意あり(TOP2) | FZ | ファネル指標3 |
| 購入意向あり | 21 | V | 購入・利用意向あり(TOP2) | GC | ファネル指標4 |
| 購入経験あり | 29 | AD | 購入・利用経験あり(TOP5) | GJ | ファネル指標5 |
| リピート意向あり | 32 | AG | リピート意向あり(TOP2) | GL | ファネル指標6 |

#### データ形式
- **ヘッダー行**: 3行目
- **データ開始**: 4行目以降
- **データ型**: 数値（パーセンテージ）
- **欠損値処理**: 「-」または空白は自動的に0として処理

### 4.2 Excel列インデックスの対応表
```
A列 = 0
B列 = 1
C列 = 2
D列 = 3  ← ブランド名
...
M列 = 12 (FT: 認知あり) ★
P列 = 15 (FW: 興味あり) ★
S列 = 18 (FZ: 好意あり) ★
V列 = 21 (GC: 購入意向あり) ★
AD列 = 29 (GJ: 購入経験あり) ★
AG列 = 32 (GL: リピート意向あり) ★
```

---

## 5. 技術仕様

### 5.1 型定義（types.ts への追加）

```typescript
// Funnel Metrics (ファネル指標)
export interface FunnelMetrics {
  FT: number;  // 認知あり(TOP2)
  FW: number;  // 興味あり(TOP2)
  FZ: number;  // 好意あり(TOP2)
  GC: number;  // 購入・利用意向あり(TOP2)
  GJ: number;  // 購入・利用経験あり(TOP5)
  GL: number;  // リピート意向あり(TOP2)
}

export const METRIC_LABELS: { [key in keyof FunnelMetrics]: string } = {
  FT: '認知あり(TOP2)',
  FW: '興味あり(TOP2)',
  FZ: '好意あり(TOP2)',
  GC: '購入・利用意向あり(TOP2)',
  GJ: '購入・利用経験あり(TOP5)',
  GL: 'リピート意向あり(TOP2)'
};

export const METRIC_KEYS: (keyof FunnelMetrics)[] = ['FT', 'FW', 'FZ', 'GC', 'GJ', 'GL'];

export type AnalysisMode = 'segment_x_multi_brand' | ...;
```

### 5.2 モード設定（constants/analysisConfigs.ts への追加）

```typescript
'segment_x_multi_brand': {
  id: 'segment_x_multi_brand',
  name: 'ファネル分析①（セグメント: X=ファネル①×ブランド）',
  description: '単一セグメントにおける複数ブランドのファネル指標を比較',
  axes: {
    items: {
      role: 'X_AXIS',
      label: '分析項目',
      allowMultiple: false,
      itemSet: 'funnel',
      fixedItems: ['FT', 'FW', 'FZ', 'GC', 'GJ', 'GL']
    },
    segments: {
      role: 'FILTER',
      label: 'データシート',
      allowMultiple: false
    },
    brands: {
      role: 'SERIES',
      label: 'ブランド比較',
      allowMultiple: true
    }
  },
  dataTransform: {
    xAxis: 'items',
    series: 'brands',
    filter: 'segments'
  },
  defaultChartType: 'bar'
}
```

### 5.3 データパース処理（App.tsx への追加）

```typescript
// Column map for funnel metrics
const funnelColMap: { [key in keyof FunnelMetrics]?: number } = {};
const funnelLabels: { [key in keyof FunnelMetrics]: string } = {
  FT: '認知あり(TOP2)',
  FW: '興味あり(TOP2)',
  FZ: '好意あり(TOP2)',
  GC: '購入・利用意向あり(TOP2)',
  GJ: '購入・利用経験あり(TOP5)',
  GL: 'リピート意向あり(TOP2)'
};

// Map headers to columns (in header parsing loop)
(Object.keys(funnelLabels) as (keyof FunnelMetrics)[]).forEach(key => {
  if (headerStr === funnelLabels[key]) {
    funnelColMap[key] = idx;
  }
});

// Initialize metrics in data row processing
const metrics: FunnelMetrics = {
  FT: 0, FW: 0, FZ: 0, GC: 0, GJ: 0, GL: 0
};

// Read funnel metrics
(Object.keys(funnelLabels) as (keyof FunnelMetrics)[]).forEach(key => {
  const colIdx = funnelColMap[key];
  if (colIdx !== undefined) {
    let val = row[colIdx];
    if (val === '-' || val === undefined || val === null) val = 0;
    metrics[key] = typeof val === 'number' ? val : parseFloat(val) || 0;
  }
});
```

---

## 6. 使用例

### シナリオ1: 競合他社との比較分析

**目的**: 「全体」セグメントで自社ブランドと競合3社のファネル指標を比較

**手順**:
1. モード1「ファネル分析①（セグメント×複数ブランド）」を選択
2. セグメント「全体」を選択
3. 自社ブランドと競合3社を選択
4. 集合縦棒グラフで6指標の比較を確認

**分析ポイント**:
- どの段階で競合に劣っているか？
- どの段階で自社が強いか？
- ファネルのどこで脱落が大きいか？

### シナリオ2: ブランドポートフォリオ分析

**目的**: 自社の複数ブランドの強み・弱みを比較

**手順**:
1. モード1を選択
2. セグメント「全体」を選択
3. 自社の複数ブランドを選択
4. レーダーチャートに切り替えて全体像を確認

**分析ポイント**:
- 各ブランドの特徴的な強み・弱み
- ポートフォリオ全体でのバランス
- 投資優先度の判断材料

---

## 7. 注意事項

### 7.1 データの解釈
1. **ファネル構造の理解**
   - 通常、FT（認知）からGL（リピート意向）に向かって数値は減少する
   - 逆転している場合は、データの品質や回答者の理解に問題がある可能性

2. **TOP2とTOP5の違い**
   - FT, FW, FZ, GC, GL: TOP2（上位2つの回答）
   - GJ: TOP5（上位5つの回答）
   - 評価基準が異なるため、直接的な数値比較は注意が必要

3. **セグメントの選択**
   - 「全体」セグメントで全体傾向を把握
   - 特定セグメント（年代別、性別など）で詳細分析

### 7.2 グラフの読み方
- **縦棒の高さ**: 各指標の数値
- **色分け**: ブランドごとに異なる色
- **並び順**: ドラッグ&ドロップで調整可能

---

## 8. 他のモードとの使い分け

### モード1とモード2の使い分け
| 観点 | モード1（セグメント固定） | モード2（ブランド固定） |
|------|-------------------------|------------------------|
| **固定軸** | セグメント（単一） | ブランド（単一） |
| **比較軸** | 複数ブランド | 複数セグメント |
| **主な用途** | 競合比較 | セグメント別分析 |

### モード1とモード3の使い分け
| 観点 | モード1 | モード3 |
|------|---------|---------|
| **X軸** | ファネル6指標（固定） | 複数ブランド |
| **データ系列** | 複数ブランド | 複数セグメント |
| **主な用途** | ブランド間の総合比較 | 特定指標での詳細比較 |

---

## 9. まとめ

モード1「ファネル分析①（セグメント×複数ブランド）」は、特定のセグメント内で複数のブランドをファネル指標で比較する基本的な分析モードです。

### 主な特徴
- **6指標評価**: 認知から購入、リピートまでの全段階を可視化
- **集合縦棒グラフ**: ブランド間の比較が直感的
- **競合分析**: 自社と競合のポジショニング把握に最適
- **ファネル構造**: 顧客行動の各段階での強み・弱みを特定

### 活用シーン
- 競合ブランドとのベンチマーク分析
- マーケティング施策の効果測定
- ブランド戦略の方向性決定
- 投資優先度の判断

このモードを活用することで、ブランドパフォーマンスを多角的に評価し、効果的なマーケティング戦略を立案できます。

---

**文書ステータス**: 要件定義完了  
**作成日**: 2025-11-29  
**バージョン**: 1.0

