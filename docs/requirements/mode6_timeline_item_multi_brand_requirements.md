# モード6 - ファネル分析②（項目×複数ブランド）要件定義書

## 最終更新
2025-11-29

---

## 1. 概要

### 1.1 モード名
**モード6**: ファネル分析②（ファネル②: X=ブランド×セグメント）

### 1.2 モードID
`timeline_item_multi_brand`

### 1.3 目的
特定の時系列指標を選択し、複数のブランドを複数のセグメントで比較することで、特定の購入・利用時期における多角的な分析を行う。

### 1.4 参照モード
**モード3**（`item_x_multi_brand`）: ファネル分析①（項目固定×複数ブランド）
**モード4**（`timeline_brand_multi_segment`）: ファネル分析②（ブランド固定×複数セグメント）
**モード5**（`timeline_segment_multi_brand`）: ファネル分析②（セグメント固定×複数ブランド）

### 1.5 モード3との類似性
| 項目 | モード3（ファネル①） | モード6（ファネル②） |
|------|---------------------|---------------------|
| **指標種別** | ファネル指標（FT～GL） | 時系列指標（T1～T5） |
| **固定軸** | 単一ファネル指標 | 単一時系列指標 |
| **X軸** | 複数ブランド | 複数ブランド |
| **データ系列** | 複数セグメント | 複数セグメント |
| **分析視点** | 「特定指標でブランド×セグメントを比較」 | 「特定時期でブランド×セグメントを比較」 |

---

## 2. 時系列指標（T1-T5）

### 2.1 指標一覧

| 指標コード | 指標名 | Excel列 | 列インデックス | 説明 |
|:---|:---|:---|:---|:---|
| T1 | 直近1ヶ月以内に購入・利用した | - | - | 最も直近の利用 |
| T2 | 過去2～3ヶ月以内に購入・利用した | - | - | やや最近の利用 |
| T3 | 過去4ヶ月～半年未満に購入・利用した | - | - | 中期の利用 |
| T4 | 半年～1年未満に購入・利用した | - | - | やや過去の利用 |
| T5 | 1年以上前に購入・利用した | - | - | 過去の利用 |

### 2.2 各指標の詳細

#### T1: 直近1ヶ月以内に購入・利用した
- **定義**: 最も直近の購入・利用
- **評価内容**: アクティブユーザーの割合
- **マーケティング的意義**: 現在の利用者の詳細比較

#### T2: 過去2～3ヶ月以内に購入・利用した
- **定義**: やや最近の購入・利用
- **評価内容**: 定期利用者の割合
- **マーケティング的意義**: 継続利用者の詳細比較

#### T3: 過去4ヶ月～半年未満に購入・利用した
- **定義**: 中期の購入・利用
- **評価内容**: 季節性や周期性のある利用
- **マーケティング的意義**: 中期利用者の詳細比較

#### T4: 半年～1年未満に購入・利用した
- **定義**: やや過去の購入・利用
- **評価内容**: 低頻度利用者の割合
- **マーケティング的意義**: 低頻度利用者の詳細比較

#### T5: 1年以上前に購入・利用した
- **定義**: 過去の購入・利用
- **評価内容**: 休眠ユーザーの割合
- **マーケティング的意義**: 休眠ユーザーの詳細比較

---

## 3. 分析モード詳細

### 3.1 分析軸の構成
- **X軸**: 選択した複数のブランド
- **データ系列**: 選択した複数のセグメント
- **フィルタ**: 時系列指標（単一選択）

### 3.2 UI要素
- **分析項目セクション**: 【SA】バッジ表示、ドロップダウン選択（5指標から1つを選択）
- **セグメントセクション**: 【MA】バッジ表示、複数選択リスト + ドラッグ＆ドロップ
- **ブランドセクション**: 【MA】バッジ表示、複数選択リスト + ドラッグ＆ドロップ

### 3.3 デフォルトチャートタイプ
**集合縦棒グラフ**

**理由**:
- ブランド間の比較が視覚的に明確
- セグメント別の違いも色分けで識別可能
- 特定の購入時期に焦点を当てた詳細比較に適している

---

## 4. データ要件

### 4.1 Excelファイルのフォーマット

#### 必要な列
| 列 | 列番号（0-based） | Excel列 | ヘッダー名 | 内部キー | 説明 |
|----|-----------------|---------|-----------|---------|------|
| ブランド名 | 3 | D | (任意) | - | ブランド識別子 |
| 直近1ヶ月 | - | - | 直近1ヶ月以内に購入・利用した | T1 | 時系列指標1 |
| 2～3ヶ月 | - | - | 過去2～3ヶ月以内に購入・利用した | T2 | 時系列指標2 |
| 4ヶ月～半年 | - | - | 過去4ヶ月～半年未満に購入・利用した | T3 | 時系列指標3 |
| 半年～1年 | - | - | 半年～1年未満に購入・利用した | T4 | 時系列指標4 |
| 1年以上前 | - | - | 1年以上前に購入・利用した | T5 | 時系列指標5 |

#### データ形式
- **ヘッダー行**: 3行目
- **データ開始**: 4行目以降
- **データ型**: 数値（パーセンテージ）
- **欠損値処理**: 「-」または空白は自動的に0として処理

---

## 5. 実装仕様

### 5.1 モード設定（constants/analysisConfigs.ts）

```typescript
'timeline_item_multi_brand': {
  id: 'timeline_item_multi_brand',
  name: 'ファネル分析②（ファネル②: X=ブランド×セグメント）',
  description: '単一分析項目における複数ブランド・セグメントの比較（時系列）',
  axes: {
    items: {
      role: 'FILTER',
      label: '分析項目',
      allowMultiple: false,
      itemSet: 'timeline'
    },
    segments: {
      role: 'SERIES',
      label: 'セグメント比較',
      allowMultiple: true
    },
    brands: {
      role: 'X_AXIS',
      label: 'ブランド比較',
      allowMultiple: true
    }
  },
  dataTransform: {
    xAxis: 'brands',
    series: 'segments',
    filter: 'items'
  },
  defaultChartType: 'bar'
}
```

### 5.2 型定義（types.ts）

**既存の型定義を流用**:
- `TimelineMetrics` インターフェース（T1～T5）
- `TIMELINE_LABELS` 定数
- `TIMELINE_KEYS` 配列
- `ItemSet` 型の `'timeline'`

### 5.3 データパース処理（App.tsx）

**既存の実装を流用**:
モード4・5で実装済みの以下の処理を活用：
- `timelineColMap` の定義
- `timelineLabels` の定義
- ヘッダー解析ループに時系列指標の検出ロジック
- データ行処理で時系列メトリクスの読み込み

---

## 6. ビジネス価値

### 6.1 分析の目的
1. **特定時期の詳細分析**: 特定の購入・利用時期に焦点を当てた詳細比較
2. **ブランド×セグメントのマトリクス分析**: 複数の軸での同時比較
3. **施策効果の詳細測定**: 特定時期に対する施策効果を詳細に測定

### 6.2 想定ユースケース

#### ユースケース1: アクティブユーザーの詳細比較
**シナリオ**: 「T1（直近1ヶ月）」指標で、自社ブランドと競合2社を、若年層・中年層・シニア層で比較

- **操作**: モード6選択 → 分析項目「T1（直近1ヶ月）」選択 → ブランド3社選択 → セグメント3つ選択
- **発見**: 自社ブランドは若年層でのアクティブユーザーが多いが、シニア層では競合に劣る
- **アクション**: シニア層向けの利用促進施策を強化

#### ユースケース2: 休眠ユーザーの詳細比較
**シナリオ**: 「T5（1年以上前）」指標で、複数ブランドを地域別に比較

- **操作**: モード6選択 → 分析項目「T5（1年以上前）」選択 → ブランド4社選択 → 地域セグメント4つ選択
- **発見**: 自社ブランドは関東では休眠ユーザーが少ないが、関西では多い
- **アクション**: 関西での掘り起こし施策を強化

#### ユースケース3: 定期利用者の詳細比較
**シナリオ**: 「T2（2～3ヶ月）」指標で、自社の複数ブランドを性年代別に比較

- **操作**: モード6選択 → 分析項目「T2（2～3ヶ月）」選択 → 自社ブランド3つ選択 → 性年代セグメント4つ選択
- **発見**: ブランドAは男性での定期利用が高いが、女性では低い
- **アクション**: 女性向けの継続利用促進施策を検討

---

## 7. 使用例

### シナリオ1: アクティブユーザーの詳細比較

**目的**: 「直近1ヶ月」に焦点を当てて、ブランド×セグメントのマトリクス分析

**手順**:
1. モード6「ファネル分析②（項目×複数ブランド）」を選択
2. 分析項目「T1（直近1ヶ月）」を選択
3. ブランド「自社ブランド」「競合A」「競合B」を選択
4. セグメント「全体」「男性」「女性」を選択
5. 集合縦棒グラフで比較

**分析ポイント**:
- どのブランドがどのセグメントでアクティブユーザーが多いか？
- 自社ブランドの強いセグメント・弱いセグメントはどこか？
- セグメント別の競合との差はどの程度か？

### シナリオ2: 休眠ユーザーの詳細比較

**目的**: 「1年以上前」に焦点を当てて、地域別のブランド比較

**手順**:
1. モード6を選択
2. 分析項目「T5（1年以上前）」を選択
3. ブランド「自社ブランド」「競合A」を選択
4. セグメント「関東」「関西」「中部」「九州」を選択
5. 横棒グラフに切り替えて比較

**分析ポイント**:
- どの地域で休眠ユーザーが多いか？
- 地域別の競合との差はどの程度か？
- 掘り起こし施策の優先度が高い地域はどこか？

---

## 8. 注意事項

### 8.1 データの解釈
1. **指標の選択が重要**
   - どの時系列指標を選択するかで分析の意味が大きく変わる
   - 分析の目的に応じて適切な指標を選択する

2. **ブランド×セグメントの組み合わせ**
   - ブランド数×セグメント数が多すぎると、グラフが見づらくなる
   - 最大でもブランド5つ×セグメント4つ程度を推奨

3. **時系列指標の特性**
   - T1～T5は過去の購入・利用時期を示す
   - 特定の時期に焦点を当てた詳細分析が可能

### 8.2 グラフの読み方
- **X軸**: 選択したブランド
- **縦棒の高さ**: 選択した指標の数値
- **色分け**: セグメントごとに異なる色
- **並び順**: ドラッグ&ドロップで調整可能

---

## 9. 他のモードとの使い分け

### モード4・5・6の使い分け
| 観点 | モード4 | モード5 | モード6 |
|------|---------|---------|---------|
| **固定軸** | ブランド | セグメント | 時系列指標 |
| **X軸** | 時系列5指標 | 時系列5指標 | 複数ブランド |
| **データ系列** | 複数セグメント | 複数ブランド | 複数セグメント |
| **主な用途** | セグメント別の総合比較 | ブランド別の総合比較 | 特定時期の詳細比較 |
| **分析の深さ** | 広く浅く | 広く浅く | 狭く深く |

### モード6の独自の価値
- **特定時期への集中**: 1つの時系列指標に焦点を当てた詳細分析
- **マトリクス分析**: ブランド×セグメントの2軸分析
- **施策効果の測定**: 特定時期に対する施策効果を詳細に測定

---

## 10. 実装上の注意点

### 10.1 モード4・5との違い
| 要素 | モード4・5 | モード6 |
|------|-----------|---------|
| フィルタ軸 | ブランドまたはセグメント | 時系列指標 |
| X軸 | 時系列5指標（固定） | 複数ブランド（可変） |
| データ系列軸 | セグメントまたはブランド | 複数セグメント（可変） |

### 10.2 UI上の違い
- **分析項目セクション**: 【固定】→【SA】に変更（ドロップダウン表示）
- **ブランドセクション**: 【SERIES】または【FILTER】→【X_AXIS】に変更（役割の変更）
- **セグメントセクション**: 【FILTER】または【SERIES】→【SERIES】に固定

### 10.3 データ変換処理
モード4・5とは異なり、X軸がブランドになるため、データ変換処理が異なる：
- `dataTransform.xAxis: 'brands'`
- `dataTransform.series: 'segments'`
- `dataTransform.filter: 'items'`

---

## 11. まとめ

モード6「ファネル分析②（項目×複数ブランド）」は、特定の時系列指標に焦点を当てた詳細分析モードです。

### 主な特徴
- **特定時期への集中**: 1つの時系列指標を詳細に分析
- **マトリクス分析**: ブランド×セグメントの2軸分析
- **柔軟な比較**: ブランドとセグメントを自由に組み合わせ
- **詳細な施策効果測定**: 特定時期に対する施策効果を測定

### 活用シーン
- 特定時期（アクティブユーザー、休眠ユーザーなど）の詳細比較
- ブランド×セグメントのマトリクス分析
- 特定時期に対する施策効果の測定
- セグメント別の競合ポジショニング分析

### モード4・5との補完関係
- **モード4・5**: 時系列全体を総合的に比較（広く浅く）
- **モード6**: 特定時期を詳細に比較（狭く深く）
- 3つのモードを併用することで、多角的なリテンション分析が可能

このモードを活用することで、特定の購入・利用時期における詳細なブランド×セグメント分析を行い、効果的なリテンション施策を立案できます。

---

**文書ステータス**: 要件定義完了  
**作成日**: 2025-11-29  
**バージョン**: 1.0

