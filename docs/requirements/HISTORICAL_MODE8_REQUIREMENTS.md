# 過去比較モード Mode 5 要件定義書

## 📋 概要

**グローバルモード**: 過去比較モード  
**モード番号**: 5  
**モードID**: `historical_future_power_segment_brand`  
**モード名**: ブランドパワー分析②（セグメント、ブランド: X=将来性パワー×過去比較）  
**実装日**: 2025-11-30  
**ステータス**: 📝 要件定義完了

---

## 🎯 目的

単一セグメント・単一ブランドにおけるブランドパワー指標（将来性パワー）の時系列変化を可視化し、過去のデータと比較することでブランドの将来性の変化や成長トレンドを分析する。

---

## 📊 モード概要

### 分析軸の構成

| 軸 | 役割 | 値 | 選択方式 | 詳細 |
|----|------|-----|---------|------|
| **分析項目** | X_AXIS | FP1, FP2, FP3, FP4, FP5, FP6 | 固定 | 将来性パワー指標 |
| **セグメント** | FILTER | セグメント名 | SA（単一選択） | 分析対象のセグメント |
| **ブランド** | FILTER | ブランド名 | SA（単一選択） | 分析対象のブランド |
| **データ系列** | SERIES | データソース（期間） | 複数（最大3） | 時系列データ |

### 将来性パワー指標（Future Power）

| 指標キー | 指標名 | 説明 |
|---------|--------|------|
| FP1 | 新しさ・新鮮さ | ブランドの新しさや新鮮な印象 |
| FP2 | 興味を持っている | ブランドへの興味関心度 |
| FP3 | 注目されている | ブランドの注目度 |
| FP4 | 知っている人が増えている | ブランド認知の拡大傾向 |
| FP5 | 購入している人が増えている | ブランド購入の増加傾向 |
| FP6 | 勧められている | ブランドの推奨度 |

---

## 🔄 詳細分析モードとの対応関係

### 対応する詳細分析モード

**詳細分析モード Mode 11**: `future_power_segment_brands`
- 名称: ブランドパワー分析②（セグメント: X=将来性パワー×ブランド）
- 比較軸: 複数ブランド間の比較
- X軸: 将来性パワー指標（FP1-FP6）
- データ系列: 複数ブランド

**過去比較モード Mode 5**: `historical_future_power_segment_brand`（本モード）
- 名称: ブランドパワー分析②（セグメント、ブランド: X=将来性パワー×過去比較）
- 比較軸: 単一ブランドの時系列比較
- X軸: 将来性パワー指標（FP1-FP6）
- データ系列: 複数時点データ

### 違いの明確化

| 項目 | 詳細分析モード (Mode 11) | 過去比較モード (Mode 5) |
|------|------------------------|------------------------|
| **比較対象** | 複数ブランド | 複数時点 |
| **セグメント選択** | SA（単一） | SA（単一） |
| **ブランド選択** | MA（複数） | SA（単一） |
| **データソース** | 1つ（現在） | 最大3つ（時系列） |
| **凡例表示** | ブランド名 | データソース名（期間） |
| **分析目的** | ブランド間の将来性比較 | 同一ブランドの将来性変化追跡 |

---

## 🔄 他の過去比較モードとの関係

### Mode 4（ブランドパワー分析①）との違い

| 項目 | Mode 4（現在パワー） | Mode 5（将来性パワー） |
|------|---------------------|---------------------|
| **指標数** | 4つ（BP1-BP4） | 6つ（FP1-FP6） |
| **指標内容** | 認知、興味・関心、購入意向、推奨意向 | 新しさ、興味、注目度、認知拡大、購入増加、推奨度 |
| **分析観点** | 現在のブランドパワー | 将来性・成長性 |
| **デフォルトチャート** | レーダーチャート | レーダーチャート |

### 共通点

- ✅ 過去比較モードの設計パターンを継承
- ✅ セグメント・ブランド共にSA（単一選択）
- ✅ データソースが系列となる
- ✅ 固定項目セット（動的選定不要）
- ✅ `transformDataForHistoricalChart`をそのまま使用可能

---

## 🎨 UI仕様

### サイドバー構成

```
┌─────────────────────────────────┐
│ [詳細分析] [過去比較] ★        │
├─────────────────────────────────┤
│ 📁 データソース管理            │
│   ○ 2025年6月  [編集] [削除]   │
│   ○ 2024年6月  [編集] [削除]   │
│   ○ 2023年6月  [編集] [削除]   │
│   [+ ファイル追加 (3/3)]        │
├─────────────────────────────────┤
│ 📊 分析モード                   │
│   ▼ Mode 5: ブランドパワー分析② │
├─────────────────────────────────┤
│ 📂 セグメント (SA)              │
│   ▼ 全体                        │
├─────────────────────────────────┤
│ 🏷️ ブランド (SA)                │
│   ▼ ブランドA                   │
├─────────────────────────────────┤
│ 📈 分析項目: 将来性パワー(固定) │
└─────────────────────────────────┘
```

### 選択制約

- **セグメント**: 単一選択（SA）固定、ドロップダウン表示
- **ブランド**: 単一選択（SA）固定、ドロップダウン表示
- **分析項目**: FP1-FP6固定、選択不可（自動）

---

## 📈 グラフ仕様

### デフォルトチャートタイプ

**レーダーチャート（Radar Chart）**

### 理由

将来性パワー分析は6つの指標を総合的に把握する必要があり、レーダーチャートが最適:
- 6つの指標のバランスを視覚的に把握
- 時系列でのブランド将来性の変化を面積で比較
- 強み・弱みの変化が一目瞭然
- 成長トレンドを直感的に理解

### 切り替え可能なチャートタイプ

- ✅ レーダーチャート（デフォルト）
- ✅ 棒グラフ
- ✅ 折れ線グラフ

### グラフ出力例（レーダーチャート）

```
         FP1（新しさ）
             ↑
             |
      FP6 ／｜＼ FP2
      推奨 /   |   \ 興味
          /    |    \
         \     |     /
      FP5 \   |   / FP3
      購入  \  |  /  注目
       増   \ | /   度
            \|/
            FP4
        （認知拡大）

凡例:
━━━ 2025年6月
─ ─ 2024年6月
・・・ 2023年6月
```

### グラフ出力例（棒グラフ）

```
100% ┤
 80% ┤
 60% ┤ ███ ▓▓▓ ░░░
 40% ┤ ███ ▓▓▓ ░░░
 20% ┤ ███ ▓▓▓ ░░░
  0% ┼────────────────────────
     FP1  FP2  FP3  FP4  FP5  FP6

凡例:
███ 2025年6月
▓▓▓ 2024年6月
░░░ 2023年6月
```

---

## 📊 データテーブル仕様

### 表示形式

```
┌────────────┬─────┬─────┬─────┬─────┬─────┬─────┐
│            │ FP1 │ FP2 │ FP3 │ FP4 │ FP5 │ FP6 │
│            │新しさ│興味 │注目 │認知 │購入 │推奨 │
│            │     │     │度   │拡大 │増   │     │
├────────────┼─────┼─────┼─────┼─────┼─────┼─────┤
│ 2025年6月  │ 58.3│ 45.2│ 42.1│ 38.5│ 32.7│ 28.4│
│ 2024年6月  │ 54.7│ 42.8│ 39.6│ 36.2│ 30.1│ 25.9│
│ 2023年6月  │ 51.2│ 40.1│ 37.4│ 33.8│ 27.5│ 23.6│
└────────────┴─────┴─────┴─────┴─────┴─────┴─────┘
```

### 表示ルール

- **行（縦軸）**: データソース名（期間）
- **列（横軸）**: 将来性パワー指標（FP1-FP6）
- **セル値**: パーセント表示（小数点第1位まで）
- **並び順**: データソースの追加順

---

## 🛠️ 技術実装仕様

### 1. 設定追加 (`constants/analysisConfigs.ts`)

```typescript
export const HISTORICAL_ANALYSIS_MODE_CONFIGS: Record<string, AnalysisModeConfig> = {
    // 既存のMode 1-4...

    'historical_future_power_segment_brand': {
        id: 'historical_future_power_segment_brand',
        name: 'ブランドパワー分析②（セグメント、ブランド: X=将来性パワー×過去比較）',
        description: '単一セグメント・単一ブランドにおける過去データとの比較（将来性パワー）',
        axes: {
            items: {
                role: 'X_AXIS',
                label: '項目',
                allowMultiple: false,
                itemSet: 'futurePower',
                fixedItems: ['FP1', 'FP2', 'FP3', 'FP4', 'FP5', 'FP6']
            },
            segments: {
                role: 'FILTER',
                label: 'セグメント',
                allowMultiple: false  // 過去比較モードでは単一選択のみ
            },
            brands: {
                role: 'FILTER',
                label: 'ブランド',
                allowMultiple: false  // 過去比較モードでは単一選択のみ
            }
        },
        dataTransform: {
            xAxis: 'items',
            series: 'dataSources',  // データソースが系列になる
            filter: 'segments'
        },
        defaultChartType: 'radar'  // レーダーチャートがデフォルト
    }
};
```

### 2. モード選択順序の更新

```typescript
export const HISTORICAL_ANALYSIS_MODE_ORDER = [
    'historical_funnel1_segment_brand',       // Mode 1
    'historical_funnel2_segment_brand',       // Mode 2
    'historical_brand_image_segment_brand',   // Mode 3
    'historical_brand_power_segment_brand',   // Mode 4
    'historical_future_power_segment_brand'   // Mode 5（新規追加）
    // 今後Mode 6-14を追加予定
];
```

### 3. 型定義の更新 (`src/types/analysis.ts`)

```typescript
export type AnalysisMode =
  | ''
  // 詳細分析モード
  | 'segment_x_multi_brand'
  // ... 他の詳細分析モード ...
  // 過去比較モード
  | 'historical_funnel1_segment_brand'
  | 'historical_funnel2_segment_brand'
  | 'historical_brand_image_segment_brand'
  | 'historical_brand_power_segment_brand'
  | 'historical_future_power_segment_brand';  // ← 新規追加
```

---

## 🔄 データ変換ロジック

### 既存ロジックの再利用

Mode 1-2-4で実装済みの`transformDataForHistoricalChart`関数をそのまま使用可能:

```typescript
// utils/dataTransforms.ts
export const transformDataForHistoricalChart = (
  dataSources: DataSource[],
  config: AnalysisModeConfig,
  selectedSegment: string,
  selectedBrand: string,
  selectedItem: string,
  labelGetters: Record<AxisType, (key: string) => string>
): ChartDataPoint[] | null
```

### データ変換の流れ

1. **アクティブなデータソースを抽出**
   ```typescript
   const activeSources = dataSources.filter(ds => ds.isActive);
   ```

2. **X軸の項目キー取得**
   ```typescript
   const xAxisKeys = config.axes.items.fixedItems;
   // ['FP1', 'FP2', 'FP3', 'FP4', 'FP5', 'FP6']
   ```

3. **各項目ごとにデータポイント生成**
   ```typescript
   {
     name: '新しさ・新鮮さ',
     '2025年6月': 58.3,
     '2024年6月': 54.7,
     '2023年6月': 51.2
   }
   ```

### データ取得パス

```typescript
const value = source.data[selectedSegment]?.[selectedBrand]?.[itemKey] || 0;
```

---

## 📊 実装の容易さ分析

### Mode 1-4で構築された資産の活用

| 資産 | 活用方法 | 変更の必要性 |
|------|---------|------------|
| **データ変換ロジック** | `transformDataForHistoricalChart` | ❌ 変更不要 |
| **UIコンポーネント** | `ChartArea`, `Sidebar` 等 | ❌ 変更不要 |
| **フック** | `useGlobalMode`, `useMultiDataSource` | ❌ 変更不要 |
| **型定義** | `DataSource`, `GlobalMode` | ❌ 変更不要 |
| **レーダーチャート** | 既存の`chartType`対応 | ❌ 変更不要 |

### 追加が必要なコード

| ファイル | 追加内容 | 行数 |
|---------|---------|------|
| `constants/analysisConfigs.ts` | Mode 5の設定 | 約30行 |
| `src/types/analysis.ts` | 型定義に1行追加 | 1行 |
| **合計** | | **約31行** |

### 予想実装時間

- **設定追加**: 3分
- **型定義更新**: 1分
- **動作確認**: 5分
- **合計**: **約10分**

---

## ✅ 完了条件

### 必須条件

- [ ] `historical_future_power_segment_brand`の設定が追加されている
- [ ] `HISTORICAL_ANALYSIS_MODE_ORDER`に追加されている
- [ ] 型定義`AnalysisMode`に追加されている
- [ ] 過去比較モードでMode 5が選択可能
- [ ] X軸にFP1-FP6が表示される
- [ ] デフォルトでレーダーチャートが表示される
- [ ] グラフの凡例にデータソース名が表示される
- [ ] データテーブルが正しく表示される
- [ ] グラフタイプ切り替えが動作する（レーダー、棒、折れ線）
- [ ] リンターエラーなし
- [ ] TypeScriptコンパイルエラーなし

### オプション条件（Phase 4で対応予定）

- [ ] CSV エクスポートが動作する
- [ ] 画像エクスポートが動作する

---

## 🧪 テストケース

### 機能テスト

| ID | テストケース | 期待結果 | 優先度 |
|----|-------------|---------|--------|
| TC-01 | Mode 5が選択肢に表示される | Mode 5が選択可能 | P0 |
| TC-02 | X軸にFP1-FP6が表示される | 6つの指標が正しく表示 | P0 |
| TC-03 | デフォルトでレーダーチャートが表示 | レーダーチャートが描画される | P0 |
| TC-04 | 棒グラフに切り替え | 棒グラフが正しく表示される | P1 |
| TC-05 | 折れ線グラフに切り替え | 折れ線グラフが正しく表示される | P1 |
| TC-06 | データテーブルの表示 | 行=データソース、列=FP1-FP6 | P0 |
| TC-07 | データソースON/OFF切り替え | グラフから該当系列が削除/追加 | P0 |
| TC-08 | セグメント変更 | グラフが正しく更新される | P0 |
| TC-09 | ブランド変更 | グラフが正しく更新される | P0 |

### エッジケーステスト

| ID | テストケース | 期待結果 | 優先度 |
|----|-------------|---------|--------|
| TC-10 | データソース1つのみ | 単一系列で表示される | P1 |
| TC-11 | データソース3つすべてON | 3系列すべて表示される | P1 |
| TC-12 | データが存在しないブランド | 0値またはエラーメッセージ | P2 |
| TC-13 | すべての指標が0の場合 | レーダーチャートが中心点のみ | P2 |

### Mode 4との比較テスト

| ID | テストケース | 期待結果 | 優先度 |
|----|-------------|---------|--------|
| TC-20 | Mode 4とMode 5を切り替え | 指標数の違い（4つ vs 6つ）が正しく表示 | P0 |
| TC-21 | 同じセグメント・ブランドでMode切り替え | 指標内容が異なることを確認 | P1 |
| TC-22 | レーダーチャートの形状比較 | 4角形（Mode 4） vs 6角形（Mode 5） | P1 |

---

## 📚 参考資料

### 関連ドキュメント

1. `docs/HISTORICAL_COMPARISON_REQUIREMENTS.md` - 過去比較モード全体の要件定義
2. `docs/HISTORICAL_MODE1_IMPLEMENTATION_REPORT.md` - Mode 1の実装実績
3. `docs/HISTORICAL_MODE2_IMPLEMENTATION_REPORT.md` - Mode 2の実装実績
4. `docs/HISTORICAL_MODE3_REQUIREMENTS.md` - Mode 3の要件定義
5. `docs/HISTORICAL_MODE4_REQUIREMENTS.md` - Mode 4の要件定義
6. `docs/mode11_future_power_requirements.md` - 対応する詳細分析モードの仕様（想定）
7. `docs/brand_power_analysis_summary.md` - ブランドパワー分析の全体設計

### 設定駆動型アプローチの成果

**Mode 1実装**: 約3日（基盤構築）  
**Mode 2実装**: 約5分（設定追加のみ）  
**Mode 3実装**: 約40分（ブランドイメージの動的選定）  
**Mode 4実装**: 約10分（設定追加のみ）  
**Mode 5実装予測**: 約10分（設定追加のみ、Mode 4とほぼ同一パターン）

---

## 🎯 実装優先度

### 高優先度 (P0)

- ✅ 要件定義書作成（本ドキュメント）
- ⏸️ 設定追加（`constants/analysisConfigs.ts`）
- ⏸️ 型定義更新（`src/types/analysis.ts`）
- ⏸️ 動作確認

### 中優先度 (P1)

- ⏸️ グラフタイプ切り替えテスト
- ⏸️ エッジケーステスト
- ⏸️ Mode 4との比較テスト

### 低優先度 (P2)

- ⏸️ CSV/画像エクスポート対応（Phase 4）
- ⏸️ ドキュメント更新

---

## 💡 実装時の注意点

### 1. レーダーチャートのデフォルト設定

```typescript
defaultChartType: 'radar'  // 必須
```

### 2. 将来性パワー指標の固定

```typescript
itemSet: 'futurePower',
fixedItems: ['FP1', 'FP2', 'FP3', 'FP4', 'FP5', 'FP6']  // 必ず6つの指標
```

### 3. データ系列はデータソース

```typescript
series: 'dataSources'  // Mode 1-4と同じ
```

### 4. 単一選択の徹底

```typescript
allowMultiple: false  // セグメント・ブランドともに単一選択
```

### 5. Mode 4との一貫性

- 同じ設定駆動型アプローチ
- 同じデータ変換関数
- 同じデフォルトチャートタイプ（レーダー）
- 指標数のみが異なる（4つ vs 6つ）

---

## 🔄 Mode 1-4からの学習ポイント

### 再利用できる実装パターン

1. **設定駆動型アプローチ**: 設定を追加するだけで動作
2. **汎用的なデータ変換**: `itemSet`が異なるだけで同じロジックが適用可能
3. **既存UIコンポーネント**: すべて修正なしで動作
4. **型安全性**: TypeScriptによるコンパイル時チェック

### Mode 4との相似性

Mode 5はMode 4とほぼ同一の構造で、指標の数と内容のみが異なる:

| 項目 | Mode 4 | Mode 5 |
|------|--------|--------|
| itemSet | `brandPower` | `futurePower` |
| 指標数 | 4つ | 6つ |
| fixedItems | BP1-BP4 | FP1-FP6 |
| その他の設定 | 完全に同一 | 完全に同一 |

この相似性により、Mode 4の実装経験がそのまま適用できる。

---

## 🚀 次のステップ

### Mode 6以降の実装計画

Mode 5の実装完了後、以下の順序で実装を進める：

1. **Mode 6**: タイムライン関連（セグメント・ブランド）
2. **Mode 7**: タイムライン関連（ブランド・セグメント）
3. **Mode 8**: タイムライン関連（項目別）
4. **Mode 9-14**: アーキタイプ分析等

### 一括実装の検討

Mode 5が5-10分で完了した場合、Mode 4-5の実装パターンは完全に確立されており、残りのモードを一括実装することで大幅な効率化が可能。

---

## 📊 実装統計（予測）

### コード変更量（予測）

| ファイル | 追加行数 | 削除行数 | 変更行数 |
|---------|---------|---------|---------|
| `constants/analysisConfigs.ts` | 30 | 1 | 31 |
| `src/types/analysis.ts` | 1 | 0 | 1 |
| **合計** | **31** | **1** | **32** |

### 再利用率（予測）

- **新規コード**: 0行
- **設定追加**: 31行
- **型定義追加**: 1行
- **再利用コード**: 100%（すべてMode 1-4の資産）

---

## ✨ 期待される成果

### 機能面

- ✅ ブランド将来性の時系列変化を可視化
- ✅ レーダーチャートによる総合的な把握
- ✅ 6つの指標のバランス変化を一目で理解
- ✅ 成長トレンドの把握

### 技術面

- ✅ 設定追加のみで実装完了
- ✅ 既存コードの変更なし
- ✅ 高い保守性と拡張性

### ビジネス面

- ✅ ブランドの成長性追跡が容易
- ✅ 将来性の変化で戦略立案に貢献
- ✅ 現在パワー（Mode 4）との比較で多角的分析
- ✅ レポート作成の効率化

---

## 🎉 まとめ

過去比較モード Mode 5は、Mode 4で確立した設計パターンを完全に踏襲し、**約10分で実装可能**な見込みです。

### 主要な特徴

1. **設定追加のみで実装**: 既存コードの変更不要
2. **レーダーチャート対応**: 既存実装を活用
3. **汎用的なデータ変換**: `itemSet: 'futurePower'`に対応
4. **完全な型安全性**: コンパイル時エラー検出
5. **Mode 4との高い一貫性**: 指標数のみが異なる

### 実装の容易さの理由

- Mode 1-4の基盤が完璧に機能
- すべてのUIコンポーネントが再利用可能
- データ変換ロジックが汎用的
- レーダーチャートも既存実装済み
- Mode 4と設定構造がほぼ同一

### Mode 4との関係

Mode 5は、Mode 4の「将来性版」として位置づけられ、両モードを組み合わせることで:
- **現在のパワー** vs **将来性のパワー**
- **安定性** vs **成長性**
- **現状把握** vs **トレンド予測**

という多角的なブランド分析が可能になります。

---

**Document Version**: 1.0  
**Last Updated**: 2025-11-30  
**Author**: AI Assistant  
**Status**: ✅ 要件定義完了  
**Next Step**: 実装フェーズへ移行

