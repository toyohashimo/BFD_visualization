# モード5 - ファネル分析②（セグメント×複数ブランド）要件定義書

## 最終更新
2025-11-29

---

## 1. 概要

### 1.1 モード名
**モード5**: ファネル分析②（セグメント: X=ファネル②×ブランド）

### 1.2 モードID
`timeline_segment_multi_brand`

### 1.3 目的
特定のセグメント内で、複数のブランドの**時系列指標（T1-T5）**を比較し、ブランド間の購入・利用時期の違いを評価する。

### 1.4 参照モード
**モード1**（`segment_x_multi_brand`）: ファネル分析①（セグメント固定×複数ブランド）
**モード4**（`timeline_brand_multi_segment`）: ファネル分析②（ブランド固定×複数セグメント）

### 1.5 モード4との差分
| 項目 | モード4（ブランド固定） | モード5（セグメント固定） |
|------|----------------------|-------------------------|
| **モードID** | `timeline_brand_multi_segment` | `timeline_segment_multi_brand` |
| **固定軸** | 単一ブランド | 単一セグメント |
| **比較軸** | 複数セグメント | 複数ブランド |
| **分析視点** | 「ブランド内でセグメントを比較」 | 「セグメント内でブランドを比較」 |
| **主な用途** | セグメント別リテンション | ブランド別リテンション |

---

## 2. 時系列指標（T1-T5）

### 2.1 指標一覧

| 指標コード | 指標名 | Excel列 | 列インデックス | 説明 |
|:---|:---|:---|:---|:---|
| T1 | 直近1ヶ月以内に購入・利用した | - | - | 最も直近の利用 |
| T2 | 過去2～3ヶ月以内に購入・利用した | - | - | やや最近の利用 |
| T3 | 過去4ヶ月～半年未満に購入・利用した | - | - | 中期の利用 |
| T4 | 半年～1年未満に購入・利用した | - | - | やや過去の利用 |
| T5 | 1年以上前に購入・利用した | - | - | 過去の利用 |

### 2.2 各指標の詳細

#### T1: 直近1ヶ月以内に購入・利用した
- **定義**: 最も直近の購入・利用
- **評価内容**: アクティブユーザーの割合
- **マーケティング的意義**: ブランド間のアクティブユーザー比較

#### T2: 過去2～3ヶ月以内に購入・利用した
- **定義**: やや最近の購入・利用
- **評価内容**: 定期利用者の割合
- **マーケティング的意義**: ブランド間の継続利用度比較

#### T3: 過去4ヶ月～半年未満に購入・利用した
- **定義**: 中期の購入・利用
- **評価内容**: 季節性や周期性のある利用
- **マーケティング的意義**: ブランド間の利用パターン比較

#### T4: 半年～1年未満に購入・利用した
- **定義**: やや過去の購入・利用
- **評価内容**: 低頻度利用者の割合
- **マーケティング的意義**: ブランド間のリテンション比較

#### T5: 1年以上前に購入・利用した
- **定義**: 過去の購入・利用
- **評価内容**: 休眠ユーザーの割合
- **マーケティング的意義**: ブランド間の離反率比較

---

## 3. 分析モード詳細

### 3.1 分析軸の構成
- **X軸**: 時系列指標（固定5項目：T1～T5）
- **データ系列**: 選択した複数のブランド
- **フィルタ**: セグメント（単一選択）

### 3.2 UI要素
- **分析項目セクション**: 【固定】バッジ表示、UI非表示（5指標は固定のため）
- **セグメントセクション**: 【SA】バッジ表示、ドロップダウン選択
- **ブランドセクション**: 【MA】バッジ表示、複数選択リスト + ドラッグ＆ドロップ

### 3.3 デフォルトチャートタイプ
**集合縦棒グラフ**

**理由**:
- 5指標の時系列推移が視覚的に明確
- 複数ブランドの比較が容易
- ブランド間の購入時期の違いを直感的に把握できる

---

## 4. データ要件

### 4.1 Excelファイルのフォーマット

#### 必要な列
| 列 | 列番号（0-based） | Excel列 | ヘッダー名 | 内部キー | 説明 |
|----|-----------------|---------|-----------|---------|------|
| ブランド名 | 3 | D | (任意) | - | ブランド識別子 |
| 直近1ヶ月 | - | - | 直近1ヶ月以内に購入・利用した | T1 | 時系列指標1 |
| 2～3ヶ月 | - | - | 過去2～3ヶ月以内に購入・利用した | T2 | 時系列指標2 |
| 4ヶ月～半年 | - | - | 過去4ヶ月～半年未満に購入・利用した | T3 | 時系列指標3 |
| 半年～1年 | - | - | 半年～1年未満に購入・利用した | T4 | 時系列指標4 |
| 1年以上前 | - | - | 1年以上前に購入・利用した | T5 | 時系列指標5 |

#### データ形式
- **ヘッダー行**: 3行目
- **データ開始**: 4行目以降
- **データ型**: 数値（パーセンテージ）
- **欠損値処理**: 「-」または空白は自動的に0として処理

---

## 5. 実装仕様

### 5.1 モード設定（constants/analysisConfigs.ts）

```typescript
'timeline_segment_multi_brand': {
  id: 'timeline_segment_multi_brand',
  name: 'ファネル分析②（セグメント: X=ファネル②×ブランド）',
  description: '単一セグメントにおける複数ブランドの時系列指標を比較',
  axes: {
    items: {
      role: 'X_AXIS',
      label: '分析項目',
      allowMultiple: false,
      itemSet: 'timeline',
      fixedItems: ['T1', 'T2', 'T3', 'T4', 'T5']
    },
    segments: {
      role: 'FILTER',
      label: 'データシート',
      allowMultiple: false
    },
    brands: {
      role: 'SERIES',
      label: 'ブランド比較',
      allowMultiple: true
    }
  },
  dataTransform: {
    xAxis: 'items',
    series: 'brands',
    filter: 'segments'
  },
  defaultChartType: 'bar'
}
```

### 5.2 型定義（types.ts）

**既存の型定義を流用**:
- `TimelineMetrics` インターフェース（T1～T5）
- `TIMELINE_LABELS` 定数
- `TIMELINE_KEYS` 配列
- `ItemSet` 型の `'timeline'`

### 5.3 データパース処理（App.tsx）

**既存の実装を流用**:
モード4で実装済みの以下の処理を活用：
- `timelineColMap` の定義
- `timelineLabels` の定義
- ヘッダー解析ループに時系列指標の検出ロジック
- データ行処理で時系列メトリクスの読み込み

---

## 6. ビジネス価値

### 6.1 分析の目的
1. **ブランド別リテンション評価**: 特定セグメント内で各ブランドのリテンション状況を評価
2. **競合比較**: ブランド間の購入時期の違いを可視化
3. **アクティブユーザー比較**: ブランド間のアクティブユーザー割合を比較

### 6.2 想定ユースケース

#### ユースケース1: 競合ブランドとのリテンション比較
**シナリオ**: 「全体」セグメントで自社ブランドと競合2社のリテンション状況を比較

- **操作**: モード5選択 → セグメント「全体」選択 → ブランド3社選択
- **発見**: 自社ブランドはT1（直近1ヶ月）が競合より高く、リテンションが良好
- **アクション**: この強みを維持する施策を継続

#### ユースケース2: 休眠ユーザーの比較
**シナリオ**: 自社の複数ブランドで休眠ユーザーの割合を比較

- **操作**: モード5選択 → セグメント「全体」選択 → 自社ブランド3つ選択
- **発見**: ブランドAはT5（1年以上前）が高く、休眠ユーザーが多い
- **アクション**: ブランドA向けの掘り起こし施策を立案

#### ユースケース3: モード1との併用分析
**シナリオ**: ファネル分析（モード1）と時系列分析（モード5）を併用

- **操作**:
  1. モード1でファネル指標（認知～購入）をブランド間で比較
  2. モード5で時系列指標（購入時期）をブランド間で比較
- **発見**: 認知は高いが直近購入が少ないブランドを特定
- **アクション**: そのブランド向けの購入促進施策を立案

---

## 7. 使用例

### シナリオ1: 競合ブランドとのリテンション比較

**目的**: 「全体」セグメントで自社ブランドと競合のリテンションを比較

**手順**:
1. モード5「ファネル分析②（セグメント×複数ブランド）」を選択
2. セグメント「全体」を選択
3. ブランド「自社ブランド」「競合A」「競合B」を選択
4. 集合縦棒グラフで比較

**分析ポイント**:
- どのブランドでアクティブユーザーが多いか？
- どのブランドで休眠ユーザーが多いか？
- ブランド間で購入時期の分布にどのような違いがあるか？

### シナリオ2: 自社ブランドポートフォリオのリテンション分析

**目的**: 自社の複数ブランドのリテンション状況を把握

**手順**:
1. モード5を選択
2. セグメント「全体」を選択
3. 自社ブランド「ブランドA」「ブランドB」「ブランドC」を選択
4. 折れ線グラフに切り替えてトレンドを確認

**分析ポイント**:
- どのブランドでリテンションが高いか？
- どのブランドで休眠ユーザーが多いか？
- ブランド間で購入時期の分布にどのような違いがあるか？

---

## 8. 注意事項

### 8.1 データの解釈
1. **時系列指標の特性**
   - T1～T5は過去の購入・利用時期を示す
   - T1が高い＝最近の購入が多い＝アクティブユーザーが多い
   - T5が高い＝過去の購入が多い＝休眠ユーザーが多い

2. **合計値の解釈**
   - T1～T5の合計が100%になるとは限らない
   - 購入経験のない回答者は含まれない

3. **ブランド間の数値差異**
   - ブランドによって購入頻度が異なるため、絶対値よりも相対的な傾向を重視

### 8.2 グラフの読み方
- **X軸**: 時系列指標（T1～T5）
- **縦棒の高さ**: 各指標の数値
- **色分け**: ブランドごとに異なる色
- **並び順**: ドラッグ&ドロップで調整可能

---

## 9. 他のモードとの使い分け

### モード1とモード5の使い分け
| 観点 | モード1（ファネル①） | モード5（ファネル②） |
|------|---------------------|---------------------|
| **指標種別** | ファネル指標（FT～GL） | 時系列指標（T1～T5） |
| **分析対象** | 認知から購入までの段階 | 購入・利用の時期 |
| **主な用途** | ファネル分析 | リテンション分析 |
| **発見内容** | ファネルの各段階の強み・弱み | 購入時期の分布、休眠ユーザー |

### モード4とモード5の使い分け
| 観点 | モード4（ブランド固定） | モード5（セグメント固定） |
|------|------------------------|-------------------------|
| **固定軸** | ブランド（単一） | セグメント（単一） |
| **比較軸** | 複数セグメント | 複数ブランド |
| **主な用途** | セグメント別リテンション | ブランド別リテンション |
| **発見内容** | セグメント間の違い | ブランド間の違い |

---

## 10. 実装上の注意点

### 10.1 モード4との完全な対称性
モード4（ブランド固定）とモード5（セグメント固定）は、固定軸と比較軸が異なるだけで構造は完全に同じ：

| 要素 | モード4 | モード5 |
|------|---------|---------|
| フィルタ軸 | 単一ブランド | 単一セグメント |
| データ系列軸 | 複数セグメント | 複数ブランド |
| X軸 | 時系列5指標（共通） | 時系列5指標（共通） |

### 10.2 データパース処理
モード4で実装済みのデータパース処理をそのまま活用できる。

### 10.3 実装の効率化
モード4の実装をコピーし、以下の箇所のみ変更すればOK：
1. モードID: `timeline_brand_multi_segment` → `timeline_segment_multi_brand`
2. axes.segments.role: `'SERIES'` → `'FILTER'`
3. axes.brands.role: `'FILTER'` → `'SERIES'`
4. dataTransform.series: `'segments'` → `'brands'`
5. dataTransform.filter: `'brands'` → `'segments'`

---

## 11. まとめ

モード5「ファネル分析②（セグメント×複数ブランド）」は、特定のセグメント内で複数のブランドを時系列指標により比較する分析モードです。

### 主な特徴
- **5指標評価**: 購入・利用時期を5段階で可視化
- **ブランド比較**: ブランド間の購入時期の違いを直感的に把握
- **リテンション分析**: ブランド間のリテンション状況を評価
- **休眠ユーザー把握**: ブランド別の休眠ユーザー割合を可視化

### 活用シーン
- 競合ブランドとのリテンション比較
- 自社ブランドポートフォリオのリテンション分析
- 休眠ユーザー掘り起こし施策の優先順位付け
- ブランド別のアクティブユーザー率の評価

### モード4との補完関係
- **モード4**: ブランド内でセグメントを比較
- **モード5**: セグメント内でブランドを比較
- 両方を併用することで、多角的なリテンション分析が可能

このモードを活用することで、ブランド別の購入・利用時期を詳細に評価し、効果的なリテンション施策を立案できます。

---

**文書ステータス**: 要件定義完了  
**作成日**: 2025-11-29  
**バージョン**: 1.0

