### 1. データインポート
- Excelファイル（.xlsx）のドラッグ&ドロップまたはファイル選択
- 複数シートの自動読み込み
- ブランド名の自動抽出と正規化
- ファネル指標（FT, FW, FZ, GC, GJ, GL）の読み込み
- 時系列指標（T1, T2, T3, T4, T5）の読み込み
- ブランドイメージ指標（133項目）の読み込み
- ブランドパワー指標（BP1-BP4）の読み込み
- 将来性パワー指標（FP1-FP6）の読み込み
- アーキタイプ指標（12原型、自動計算）の読み込み

### 1.1 グローバルモード選択（NEW）

本アプリケーションは2つのグローバルモードを提供します：

#### 詳細分析モード
- **目的**: 複数ブランド/セグメントの横断比較
- **データソース**: 単一のExcelファイル
- **選択方式**: ブランド・セグメントを複数選択（最大10個）
- **用途**: 競合分析、セグメント間比較、項目別比較

#### 過去比較モード（NEW）
- **目的**: 時系列データの推移分析
- **データソース**: 最大3つのExcelファイル
- **選択方式**: ブランド・セグメントは単一選択、データソースを複数選択
- **用途**: トレンド分析、時系列推移、期間比較

### 2. 分析モードの詳細

本アプリケーションは、**詳細分析モード14種類** + **過去比較モード6種類（実装済み）+ 8種類（予定）**の計28種類の分析モードを提供します。

#### A. 詳細分析モード（14種類）

詳細分析モードでは、単一のExcelファイルから複数のブランドやセグメントを選択して横断比較を行います。

##### カテゴリーA1: ファネル分析①（3モード）

##### モード1: セグメント×複数ブランド
**目的**: 1つのセグメント内で複数ブランドを比較

- **分析項目**: 【固定】ファネル①指標6項目（FT, FW, FZ, GC, GJ, GL）
- **セグメント**: 【SA】単一選択
- **ブランド**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）

**表示形式**:
- X軸: ファネル①指標
- データ系列: 選択した各ブランド

**使用例**: 「全体」セグメントで複数ブランドのファネル指標を比較

##### モード2: ブランド×複数セグメント  
**目的**: 1つのブランドを複数セグメント間で比較

- **分析項目**: 【固定】ファネル①指標6項目
- **セグメント**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）
- **ブランド**: 【SA】単一選択

**表示形式**:
- X軸: ファネル①指標
- データ系列: 選択した各セグメント

**使用例**: 「スターバックス」を男性・女性・年齢層別で比較

##### モード3: 項目×複数ブランド
**目的**: 特定の指標で複数ブランドを複数セグメントで比較

- **分析項目**: 【SA】ファネル①指標から1つを選択
- **セグメント**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）
- **ブランド**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）

**表示形式**:
- X軸: 選択した各ブランド
- データ系列: 選択した各セグメント

**使用例**: 「FT（認知あり）」指標で複数ブランドをセグメント別に比較

##### カテゴリーA2: ファネル分析②（3モード）

##### モード4: 時系列：セグメント×複数ブランド
**目的**: 1つのセグメント内で複数ブランドの時系列項目を比較

- **分析項目**: 【固定】ファネル②指標5項目（T1-T5）
- **セグメント**: 【SA】単一選択
- **ブランド**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）

**表示形式**:
- X軸: ファネル②指標
- データ系列: 選択した各ブランド

**使用例**: 「全体」セグメントで複数ブランドの直近利用状況を比較

##### モード5: 時系列：ブランド×複数セグメント
**目的**: 1つのブランドの時系列項目を複数セグメントで比較

- **分析項目**: 【固定】ファネル②指標5項目
- **セグメント**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）
- **ブランド**: 【SA】単一選択

**表示形式**:
- X軸: ファネル②指標
- データ系列: 選択した各セグメント

**使用例**: 「スターバックス」の購入時期分布をセグメント別に比較

##### モード6: 時系列：項目×複数ブランド
**目的**: 特定の時系列項目で複数ブランドを複数セグメントで比較

- **分析項目**: 【SA】ファネル②指標から1つを選択
- **セグメント**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）
- **ブランド**: 【MA】複数選択（ドラッグ&ドロップで並び替え可能）

**表示形式**:
- X軸: 選択した各ブランド
- データ系列: 選択した各セグメント

**使用例**: 「T1（直近1ヶ月以内に購入・利用）」で複数ブランドをセグメント別に比較

##### カテゴリーA3: ブランドイメージ分析（2モード）

##### モード7: ブランド分析（セグメント×複数ブランド）
**目的**: 1つのセグメント内で複数ブランドのブランドイメージを比較

- **分析項目**: 【固定】ブランドイメージ項目（TOP30、自動選定）
- **セグメント**: 【SA】単一選択
- **ブランド**: 【MA】複数選択（ドラッグ＆ドロップで並び替え可能）

**表示形式**:
- X軸: ブランドイメージ項目（先頭ブランドのTOP30）
- データ系列: 選択した各ブランド

**使用例**: 「全体」セグメントで複数ブランドのイメージを比較

**特記事項**:
- デフォルトチャート: 縦棒グラフ（横棒グラフやレーダーチャートも選択可）
- 先頭ブランドが基準となりTOP30項目を自動選定
- X軸ラベルは縦方向に表示（項目数が多いため）

##### モード8: ブランド分析（ブランド×複数セグメント）
**目的**: 1つのブランドを複数セグメント間でブランドイメージを比較

- **分析項目**: 【固定】ブランドイメージ項目（TOP30、自動選定）
- **セグメント**: 【MA】複数選択（ドラッグ＆ドロップで並び替え可能）
- **ブランド**: 【SA】単一選択

**表示形式**:
- X軸: ブランドイメージ項目（先頭セグメントでのTOP30）
- データ系列: 選択した各セグメント

**使用例**: 「スターバックス」のイメージをセグメント別に比較

**特記事項**:
- デフォルトチャート: 縦棒グラフ（横棒グラフやレーダーチャートも選択可）
- 先頭セグメントが基準となりTOP30項目を自動選定
- X軸ラベルは縦方向に表示（項目数が多いため）

##### カテゴリーA4: ブランドパワー分析（4モード）

**モード9-12**: 4つのブランドパワー分析モードを提供（省略）

##### カテゴリーA5: アーキタイプ分析（2モード）

**モード13-14**: 2つのアーキタイプ分析モードを提供（省略）

#### B. 過去比較モード（6種類・実装済み + 8種類・予定）

過去比較モードでは、最大3つのExcelファイルを読み込み、時系列でのデータ推移を比較します。

##### 実装済みモード（6種類）

**Mode 1: ファネル分析①（過去比較）**
- **目的**: 単一セグメント・単一ブランドのファネル①指標の時系列推移
- **X軸**: ファネル①指標6項目（固定）
- **データ系列**: 各データソース（最大3つ）
- **デフォルトチャート**: 縦棒グラフ

**Mode 2: ファネル分析②（過去比較）**
- **目的**: 単一セグメント・単一ブランドのファネル②指標の時系列推移
- **X軸**: ファネル②指標5項目（固定）
- **データ系列**: 各データソース（最大3つ）
- **デフォルトチャート**: 縦棒グラフ

**Mode 3: ブランドイメージ分析（過去比較）**
- **目的**: 単一セグメント・単一ブランドのブランドイメージの時系列推移
- **X軸**: ブランドイメージ項目TOP30（基準データソースの降順で自動選定）
- **データ系列**: 各データソース（最大3つ）
- **デフォルトチャート**: 縦棒グラフ
- **特記事項**: 基準データソース警告を表示

**Mode 4: ブランドパワー分析①（過去比較）**
- **目的**: 単一セグメント・単一ブランドの現在パワーの時系列推移
- **X軸**: ブランドパワー指標4項目（固定）
- **データ系列**: 各データソース（最大3つ）
- **デフォルトチャート**: レーダーチャート

**Mode 5: ブランドパワー分析②（過去比較）**
- **目的**: 単一セグメント・単一ブランドの将来性パワーの時系列推移
- **X軸**: 将来性パワー指標6項目（固定）
- **データ系列**: 各データソース（最大3つ）
- **デフォルトチャート**: レーダーチャート

**Mode 6: アーキタイプ分析（過去比較）**
- **目的**: 単一セグメント・単一ブランドのアーキタイプの時系列推移
- **X軸**: アーキタイプ指標12項目（固定）
- **データ系列**: 各データソース（最大3つ）
- **デフォルトチャート**: レーダーチャート

##### 実装予定モード（8種類）

Mode 7-14は、詳細分析モードの残り8モードに対応する過去比較機能です。設定駆動型アプローチにより、平均3-10分で実装可能です。

##### データソース管理機能

- **最大3ファイル**: 同時に読み込み可能
- **自動命名**: ファイル名から期間を抽出（例: `BFD_202506.xlsx` → `2025年6月`）
  - 対応パターン: `YYYY_MM`, `YYYY-MM`, `YYYYMM`, `YYYY_Q1-Q4`, `MonYYYY`等
- **名前編集**: データソース名を手動変更可能（最大20文字）
- **ON/OFF切り替え**: データソースごとに表示/非表示を切り替え（最低1つは有効）
- **一括削除**: 全データソースをワンクリックでクリア
- **リロード時クリア**: 画面リロード時に自動的にデータソースをクリア

### 3. グラフ表示
- **集合縦棒グラフ**: 標準的な比較グラフ
- **集合横棒グラフ**: データラベルが見やすい横向きグラフ
- **折れ線グラフ**: トレンドの把握に適したグラフ
- **レーダーチャート**: 多項目の全体像を把握するグラフ（モード9のデフォルト）
- データラベルの表示/非表示切り替え
- グラフ高さのカスタマイズ機能（リサイズハンドルで調整可能）

### 4. カラーテーマ
10種類のカラーテーマから選択可能:
- スタンダード (青・紫) - デフォルト
- ビビッド (高コントラスト)
- パステル (優しい色合い)
- ビジネス (落ち着いた色)
- モノクロ (グレースケール)
- ネオン (蛍光色)
- アース (ナチュラル)
- オーシャン (ブルー系)
- サンセット (オレンジ・ピンク系)
- フォレスト (グリーン系)

### 5. データエクスポート
- **PNG画像**: グラフのみ、またはグラフ+テーブル
- **CSV**: テーブルデータのエクスポート

---

## UI構成

### アイコンバー（左端）

常に表示される縦型のアイコンバー。サイドバーを閉じても主要機能にアクセス可能。

#### サイドバー開閉トグル
- 一番上に配置（位置が常に同じ）
- 開いている時: `<` アイコン
- 閉じている時: `>` アイコン

#### クイックアクセス機能
- **グラフタイプ切り替え**: 集合縦棒、横棒、折れ線、レーダー
- **スクリーンショット**: グラフのみ、またはグラフ＋テーブル
- **CSV出力**: データテーブルをCSV形式でエクスポート
- ホバーでツールチップ表示

### サイドバー（左）

#### ファイルアップロード領域
- ドラッグ&ドロップゾーン
- ファイル選択ボタン
- アップロード状態の表示
- 匿名化トグル（ヘッダー部分をクリック）

#### 設定セクション

**分析モード選択**
- ドロップダウンで6つのモードから選択
- 各モードには番号付き: 1〜6

**分析項目** 
- タイプ表示: 【固定】または【SA】
- モード3・6でのみドロップダウン表示
- モード1・2・4・5では固定値（UI非表示）

**セグメント（データシート）**
- タイプ表示: 【SA】または【MA】
- SA（単一選択）: ドロップダウンで選択
- MA（複数選択）: 追加ドロップダウン + ドラッグ&ドロップリスト + 削除アイコン

**ブランド**
- タイプ表示: 【SA】または【MA】
- SA（単一選択）: ドロップダウンで選択
- MA（複数選択）: 追加ドロップダウン + ドラッグ&ドロップリスト + 削除アイコン

**グラフオプション**
- グラフタイプ切り替え
- データラベル表示切り替え
- カラーテーマ選択（アコーディオン）

#### アクション
- スクリーンショット（グラフのみ / グラフ+テーブル）
- CSV エクスポート

### メインエリア（右）
- リアルタイム更新されるグラフ
- データテーブル

---

## コンポーネント構造

### 主要コンポーネント

```
App.tsx (メインコンポーネント)
├── IconBar.tsx (アイコンバー)
├── Sidebar.tsx (サイドバー全体)
│   ├── AnalysisItemsSection.tsx (分析項目セクション)
│   ├── SegmentsSection.tsx (セグメントセクション)
│   └── BrandsSection.tsx (ブランドセクション)
├── ChartArea.tsx (グラフ表示エリア)
└── SortableBrandItem.tsx (ドラッグ&ドロップ可能なアイテム)
```

### データフロー

```
1. Excel File Upload
   ↓
2. Data Parsing (parseExcelData in App.tsx)
   ↓
3. State Management (App.tsx)
   ↓
4. Analysis Mode Logic (analysisConfigs.ts)
   ↓
5. Chart Data Generation (dataTransforms.ts)
   ↓
6. Recharts Rendering (ChartArea.tsx)
```

---

## 技術スタック

### フレームワーク・ライブラリ
- **React** (v19): UIフレームワーク
- **TypeScript**: 型安全性
- **Vite**: ビルドツール・開発サーバー
- **Tailwind CSS**: スタイリング

### 主要ライブラリ
- **recharts**: グラフ描画
- **xlsx**: Excelファイル解析
- **@dnd-kit**: ドラッグ&ドロップ機能
- **lucide-react**: アイコン
- **html2canvas**: スクリーンショット生成

---

## データ構造

### ファネル指標 (FunnelMetrics)

```typescript
{
  FT: number,  // 認知あり(TOP2)
  FW: number,  // 興味あり(TOP2)
  FZ: number,  // 好意あり(TOP2)
  GC: number,  // 購入・利用意向あり(TOP2)
  GJ: number,  // 購入・利用経験あり(TOP5)
  GL: number   // リピート意向あり(TOP2)
}
```

### 時系列指標 (TimelineMetrics)

```typescript
{
  T1: number,  // 直近1ヶ月以内に購入・利用した
  T2: number,  // 過去2～3ヶ月以内に購入・利用した
  T3: number,  // 過去4ヶ月～半年未満に購入・利用した
  T4: number,  // 半年～1年未満に購入・利用した
  T5: number   // 1年以上前に購入・利用した
}
```

### 全指標 (AllMetrics)

```typescript
// FunnelMetrics と TimelineMetrics を統合
{
  FT: number, FW: number, FZ: number, GC: number, GJ: number, GL: number,
  T1: number, T2: number, T3: number, T4: number, T5: number
}
```

### 分析モード (AnalysisMode)

```typescript
type AnalysisMode = 
  | 'segment_x_multi_brand'         // モード1
  | 'brand_x_multi_segment'         // モード2
  | 'item_x_multi_brand'            // モード3
  | 'timeline_brand_multi_segment'  // モード4
  | 'timeline_segment_multi_brand'  // モード5
  | 'timeline_item_multi_brand';    // モード6
```

---

## 操作方法

### 基本的な使用フロー

1. **Excelファイルをアップロード**
   - ファイルをドラッグ&ドロップまたは選択
   - または、自動読み込みされるsample.xlsxを使用

2. **分析モードを選択**
   - 目的に応じて6つのモードから選択

3. **セグメント・ブランド・項目を選択**
   - モードに応じて単一/複数選択
   - ドラッグ&ドロップで表示順を調整

4. **グラフオプションを調整**
excel_visualization2/
├── components/
│   ├── IconBar.tsx              (アイコンバー - NEW)
│   ├── AnalysisItemsSection.tsx  (分析項目セクション)
│   ├── BrandsSection.tsx         (ブランドセクション)
│   ├── ChartArea.tsx             (グラフエリア)
│   ├── SegmentsSection.tsx       (セグメントセクション)
│   ├── Sidebar.tsx               (サイドバー)
│   └── SortableBrandItem.tsx     (D&Dアイテム)
├── constants/
│   ├── analysisConfigs.ts        (分析モード設定 - 重要)
│   └── modeConfigs.ts            (モード関連設定)
├── utils/
│   └── dataTransforms.ts         (データ変換ロジック)
├── types.ts                      (型定義)
├── constants.ts                  (定数・初期データ)
├── App.tsx                       (メインアプリ)
└── docs/
    ├── requirements_definition.md  (要件定義書)
    ├── specification.md            (本ドキュメント)
    ├── technical_specification.md  (技術仕様書)
- **スクリーンショット**: グラフのみ、グラフ＋データ
- **ツールチップ**: 各アイコンに機能名表示

#### サイドバー機能の重複配置
- サイドバー内にもグラフタイプとスクリーンショットボタンを配置
- ユーザーが好みの場所からアクセス可能

**成果**: サイドバーを閉じても画面を広く使える一方、主要機能へのクイックアクセスを維持

### 2025-11-26: バージョン2.0 - 6モード対応・汎用化アーキテクチャ

#### 分析モードの拡張
- 3モード → 6モードへの拡張
- 時系列分析モード（3モード）の追加
- 時系列指標（T1-T5）のサポート

#### アーキテクチャの汎用化
設定駆動型アプローチにより、新しいモードの追加が容易に：
- `constants/analysisConfigs.ts`に各モードの設定を集約
- 共通のデータ変換ロジック（`utils/dataTransforms.ts`）
- 動的UI生成により条件分岐を削減

#### コンポーネント分割
サイドバーの複雑なロジックを3つの子コンポーネントに分割:
- `AnalysisItemsSection.tsx` (48行)
- `SegmentsSection.tsx` (138行)
- `BrandsSection.tsx` (138行)

**成果**: Sidebarコンポーネントのコード量を150行→40行に削減（73%削減）

#### UIフィードバック対応
1. **ラベル変更**: "セグメント（データシート）" → "セグメント"
2. **タイプ表示追加**: 各セクションに【固定】【SA】【MA】バッジ
3. **クリアボタン最適化**:
   - テキストボタン → ゴミ箱アイコン
   - 専用クリア関数で1クリック全削除を実現

---

## 今後の拡張性

### 容易に追加可能な機能
- 新しい分析モードの追加（`analysisConfigs.ts`に設定を追加）
- 新しいカラーテーマ（`constants.ts`に定義）
- 新しいグラフタイプ（Rechartsコンポーネントを追加）
- 新しい指標セット（`types.ts`に型定義を追加）

### アーキテクチャの利点
- コンポーネント分割により保守性が高い
- TypeScriptによる型安全性
- 状態管理が一元化されている（App.tsx）
- ドラッグ&ドロップ機能の再利用性
- 設定駆動型により拡張が容易

---

## サポート・問い合わせ

本アプリケーションに関する質問や問題は、プロジェクトリポジトリのIssueセクションで報告してください。

---

## 補足: 各モードの詳細比較表

| モード | ID | 分析項目 | セグメント | ブランド | X軸 | データ系列 |
|:---|:---|:---|:---|:---|:---|:---|
| 1 | segment_x_multi_brand | 固定（ファネル） | SA | MA | ファネル指標 | ブランド |
| 2 | brand_x_multi_segment | 固定（ファネル） | MA | SA | ファネル指標 | セグメント |
| 3 | item_x_multi_brand | SA（ファネル） | MA | MA | ブランド | セグメント |
| 4 | timeline_brand_multi_segment | 固定（時系列） | MA | SA | 時系列指標 | セグメント |
| 5 | timeline_segment_multi_brand | 固定（時系列） | SA | MA | 時系列指標 | ブランド |
| 6 | timeline_item_multi_brand | SA（時系列） | MA | MA | ブランド | セグメント |
| 7 | brand_image_segment_brands | 固定（イメージ） | SA | MA | ブランドイメージ | ブランド |
| 8 | brand_analysis_segment_comparison | 固定（イメージ） | MA | SA | ブランドイメージ | セグメント |
| 9 | brand_power_segment_brands | 固定（パワー） | SA | MA | ブランドパワー | ブランド |

**凡例**:
- **SA**: Single Select（単一選択）
- **MA**: Multiple Select（複数選択）
- **固定**: 変更不可の固定値（6項目、5項目、または4項目）
