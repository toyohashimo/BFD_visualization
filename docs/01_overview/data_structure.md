# sample.xlsx 構造解析結果

このドキュメントは、アプリケーションで使用される入力ファイル `sample.xlsx` の構造と仕様を解析した結果をまとめたものです。
この解析は、`App.tsx` 内のファイル解析ロジック（`parseExcelData` 関数）に基づいています。

## 1. ファイル概要

- **ファイル形式**: Microsoft Excel (.xlsx)
- **用途**: アプリケーションへのデータ入力（ファネル分析用データ）
- **シート構成**: 複数のシートを含むことが可能。各シートが1つのセグメント（またはデータセット）として扱われます。

## 2. シート構造

各シートは以下の共通フォーマットに従う必要があります。

### 2.1 行の構成

| 行番号 (1-based) | 役割 | 説明 |
| :--- | :--- | :--- |
| **1** | **カテゴリ行** | 各列のカテゴリ名（例：「現在パワー項目構成要素」「共通68イメージ」） |
| **2** | **項目名行** | 各列の項目名（例：「認知あり」「ブランドイメージ」） |
| **3** | **ヘッダー行** | 各列の詳細項目名（実際のヘッダーとして使用） |
| **4 以降** | **データ行** | 各ブランドの指標データが格納されます。 |

### 2.2 列の構成

解析ロジックは特定の列インデックスとヘッダー名を基準にデータを抽出します。

#### 必須列

| 列 (Excel) | インデックス (0-based) | 項目名 | データ型 | 説明 |
| :--- | :--- | :--- | :--- | :--- |
| **D** | 3 | (任意) | String | **ブランド名**。この列の値がブランドの識別子として使用されます。 |

#### 指標列 (Metrics)

以下のヘッダー名を持つ列が検索され、対応する指標としてマッピングされます。列の位置は固定ではなく、ヘッダー名の一致によって特定されます。

**ファネル指標（必須）**

| ヘッダー名 (完全一致) | 内部キー | 説明 |
| :--- | :--- | :--- |
| `認知あり(TOP2)` | `FT` | 認知率 |
| `興味あり(TOP2)` | `FW` | 興味・関心率 |
| `好意あり(TOP2)` | `FZ` | 好意度 |
| `購入・利用意向あり(TOP2)` | `GC` | 購入意向 |
| `購入・利用経験あり(TOP5)` | `GJ` | 購入経験 |
| `リピート意向あり(TOP2)` | `GL` | リピート意向 |

> **注意**: `認知あり(TOP2)` (FT) の列が存在しない場合、そのシートのデータは無効とみなされスキップされます。

**時系列指標（オプション）**

| ヘッダー名 (完全一致) | 内部キー | 説明 |
| :--- | :--- | :--- |
| `直近1ヶ月以内に購入・利用した` | `T1` | 直近1ヶ月 |
| `過去2～3ヶ月以内に購入・利用した` | `T2` | 過去2～3ヶ月 |
| `過去4ヶ月～半年未満に購入・利用した` | `T3` | 過去4ヶ月～半年 |
| `半年～1年未満に購入・利用した` | `T4` | 半年～1年 |
| `1年以上前に購入・利用した` | `T5` | 1年以上前 |

**ブランドイメージ指標（オプション、モード7・8・13・14で使用）**

ブランドイメージ項目は、**パターンマッチング方式**で動的に抽出されます。

| 抽出方法 | 説明 |
| :--- | :--- |
| **パターンマッチング** | 行1（2行目）に「ブランドイメージ」を含む列を自動検索 |
| **ヘッダー行** | 行2（3行目）から実際の項目名を取得 |
| **除外キーワード** | 「あてはまるものはない」を含む項目は自動除外 |

> **注意**: 
> - ブランドイメージ項目は列位置に依存せず、行1（2行目）の項目名に「ブランドイメージ」を含む列を自動的に検出します
> - ファイルごとに列数が異なっても（例：202406ファイルは207列、202506ファイルは195列）自動的に対応可能です
> - 実際の項目名は行2（3行目）のヘッダーから取得されます
> - モード13・14（アーキタイプ分析）では、抽出されたブランドイメージ項目の前半68項目を使用します

## 3. データ解析ルール

### 3.1 値の処理

- **数値**: そのまま数値として読み込まれます。
- **文字列**: `parseFloat` で数値変換を試みます。
- **無効値**: `'-'`, `undefined`, `null` は `0` として扱われます。

### 3.2 バリデーション

以下の条件を満たさないシートは読み込み時に無視、またはエラーとなります。

1. **データ行数**: 全体の行数が4行未満の場合、スキップされます。
2. **必須指標**: `認知あり(TOP2)` の列が見つからない場合、スキップされます。
3. **ブランド名**: D列（インデックス3）に値が存在しない行はスキップされます。
4. **有効データ**: 有効なブランドデータが1つも見つからない場合、エラーメッセージが表示されます。

## 4. サンプル構造イメージ

```csv
(行1) ...
(行2) ...
(行3) , , , ブランド名, 認知あり(TOP2), 興味あり(TOP2), ...
(行4) , , , Brand A, 80.5, 60.2, ...
(行5) , , , Brand B, 40.0, 20.0, ...
```

## 5. コード参照

解析ロジックの詳細は以下のファイルで確認できます。

- ファイル: `App.tsx`
- 関数: `parseExcelData`
- 依存ライブラリ: `xlsx` (SheetJS)
