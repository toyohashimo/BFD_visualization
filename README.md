# BFD Analytics

ブランドファネル分析Webアプリケーション

## 🎉 過去比較モード Mode 1-9 実装完了 (2025-12-01)

過去比較モードの**Mode 1-9（9つの分析モード）**が完成しました！

### 実装済みモード（セグメント軸）
- ✅ **Mode 1**: ファネル分析①（ファネル指標）
- ✅ **Mode 2**: ファネル分析②（タイムライン指標）
- ✅ **Mode 3**: ブランドイメージ分析（TOP30自動選定）
- ✅ **Mode 4**: ブランドパワー分析①（現在パワー）
- ✅ **Mode 5**: ブランドパワー分析②（将来性パワー）
- ✅ **Mode 6**: アーキタイプ分析（12原型）

### 実装済みモード（ブランド軸）
- ✅ **Mode 7**: ファネル分析①（ブランド×過去比較）
- ✅ **Mode 8**: ファネル分析②（ブランド×過去比較）
- ✅ **Mode 9**: ブランドイメージ分析（ブランド×過去比較）

### 主な機能
- ✅ **グローバルモード切り替え**: 詳細分析 ⇔ 過去比較の切り替え
- ✅ **複数データソース管理**: 最大3ファイルの同時読み込み
- ✅ **データソース命名**: ファイル名から自動抽出（例：BFD_202506.xlsx → 2025年6月）
- ✅ **過去比較グラフ**: 時系列データの可視化（棒グラフ・折れ線グラフ・レーダーチャート）
- ✅ **過去比較データテーブル**: データソースごとの数値比較
- ✅ **データソース管理**: ON/OFF切り替え、名前変更、一括削除
- ✅ **ブランド軸比較**: 複数ブランドの時系列比較（Mode 7-9）

### ドキュメント
- 📄 [マスターガイド](./docs/HISTORICAL_MODES_MASTER_GUIDE.md) - 全体概要と実装パターン（50ページ超）
- 📄 [実装ガイド](./docs/HISTORICAL_MODES_IMPLEMENTATION_GUIDE.md) - 実装手順と知見
- 📄 [要件定義書](./docs/HISTORICAL_COMPARISON_REQUIREMENTS.md) - 全体要件
- 📄 個別実装報告書（Mode 1-9）- 各モードの詳細

---

## 🎉 リファクタリング完了 (2025-11-29)

このプロジェクトは大規模なリファクタリングを完了しました。詳細は [REFACTORING_COMPLETION_REPORT.md](./REFACTORING_COMPLETION_REPORT.md) をご覧ください。

### 主な改善点
- **App.tsxの行数を42%削減** (990行 → 575行)
- **17個の専用モジュールを新規作成** (型定義、ユーティリティ、サービス、フック)
- **保守性・テスタビリティ・再利用性が大幅に向上**
- **UI/UX改善**: ラベル表記の統一、モード4・5の挙動修正

---

## 📋 プロジェクト概要

Excelファイルをアップロードし、12種類の分析モードで多角的なデータ可視化を実現するReactアプリケーションです。

### 主な機能
- Excelファイルの読み込みとパース
- **14種類の分析モード（詳細分析）+ 6種類の過去比較モード**
- インタラクティブなグラフ表示 (棒グラフ、折れ線グラフ、レーダーチャート)
- **過去比較機能（Mode 1-6完成、全14モード中43%完了）**
- ドラッグ&ドロップによるデータ並び替え
- CSV/画像エクスポート
- ブランド名の匿名化機能
- データソースの一括管理と切り替え

### 📍 現在のステータス (v3.0.0-beta)
- ✅ **詳細分析モード**: 14モード完成（100%）
- ✅ **過去比較Mode 1-6**: 完成（6/14モード = 43%）
  - Mode 1: ファネル分析①
  - Mode 2: ファネル分析②
  - Mode 3: ブランドイメージ分析
  - Mode 4: ブランドパワー分析①
  - Mode 5: ブランドパワー分析②
  - Mode 6: アーキタイプ分析
- 🚧 **過去比較Mode 7-14**: 実装予定（残り8モード）
  - 設定駆動型アプローチにより、平均3-10分で実装可能
  - 詳細は[マスターガイド](./docs/HISTORICAL_MODES_MASTER_GUIDE.md)を参照

### 🚧 今後の実装予定（v3.0.0正式版）

- **過去比較モード Mode 7-14**: 残り8モードの実装
  - 各モードの設定追加のみ（新規コード不要）
  - 平均実装時間: 3-10分/モード
  - 予想総時間: 約1-2時間

---

## 🚀 セットアップ

### 前提条件
- Node.js 18.x 以上
- npm 9.x 以上

### インストール

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# プロダクションビルド
npm run build

# プレビュー
npm run preview
```

---

## 📁 プロジェクト構造 (リファクタリング後)

```
excel_visualization2/
├── src/
│   ├── types/              # 型定義
│   │   ├── metrics.ts      # メトリクス型
│   │   ├── data.ts         # データ構造型
│   │   ├── analysis.ts     # 分析モード型
│   │   └── index.ts        # エントリーポイント
│   ├── utils/              # ユーティリティ
│   │   ├── formatters.ts   # フォーマット関数
│   │   └── validators.ts   # バリデーション関数
│   ├── config/             # 設定
│   │   └── constants.ts    # アプリケーション定数
│   ├── services/           # ビジネスロジック
│   │   └── excelParser/
│   │       └── ExcelParser.ts  # Excelパーサー
│   └── hooks/              # カスタムフック
│       ├── usePersistence.ts          # localStorage同期
│       ├── useExcelParser.ts          # Excelパース
│       ├── useDataManagement.ts       # データ管理
│       ├── useAnalysisState.ts        # 分析状態管理
│       ├── useChartConfiguration.ts   # チャート設定
│       ├── useColorMapping.ts         # 色マッピング
│       ├── useDragAndDrop.ts          # ドラッグ&ドロップ
│       ├── useImageExport.ts          # 画像エクスポート
│       └── useCSVExport.ts            # CSVエクスポート
├── components/             # UIコンポーネント
│   ├── Sidebar.tsx
│   ├── ChartArea.tsx
│   ├── IconBar.tsx
│   └── ...
├── constants/              # 既存定数 (段階的移行中)
│   ├── analysisConfigs.ts
│   └── modeConfigs.ts
├── App.tsx                 # メインコンポーネント (575行)
└── ...
```

---

## 🔧 技術スタック

| カテゴリ | 技術 | バージョン |
|---------|------|----------|
| フレームワーク | React | 19.2.0 |
| 言語 | TypeScript | 5.8.2 |
| ビルドツール | Vite | 6.2.0 |
| チャートライブラリ | Recharts | 3.4.1 |
| Excelパーサー | XLSX | 0.18.5 |
| ドラッグ&ドロップ | @dnd-kit/* | latest |
| スタイリング | Tailwind CSS | - |

---

## 📖 使い方

### 1. Excelファイルのアップロード
- サイドバーの「ファイルを選択」ボタンからExcelファイルをアップロード
- または、メインエリアにファイルをドラッグ&ドロップ
- データが無い場合は、メインエリアにファイルアップロード画面が表示されます

### 2. グローバルモードの選択
- **詳細分析モード**: 複数ブランド/セグメントの横断比較
- **過去比較モード**: 時系列データの推移分析

### 3. 分析モードの選択

#### 詳細分析モード（14種類）
1. ファネル分析①: セグメント × 複数ブランド
2. ファネル分析①: ブランド × 複数セグメント
3. ファネル分析①: 項目 × 複数ブランド
4. ファネル分析②: セグメント × 複数ブランド
5. ファネル分析②: ブランド × 複数セグメント
6. ファネル分析②: 項目 × 複数ブランド
7. ブランドイメージ: セグメント × 複数ブランド
8. ブランドイメージ: ブランド × 複数セグメント
9. ブランドパワー①: セグメント × 複数ブランド
10. ブランドパワー①: ブランド × 複数セグメント
11. ブランドパワー②: セグメント × 複数ブランド
12. ブランドパワー②: ブランド × 複数セグメント
13. アーキタイプ: セグメント × 複数ブランド
14. アーキタイプ: ブランド × 複数セグメント

#### 過去比較モード（6種類・実装済み + 8種類・予定）
1. ✅ ファネル分析①（過去比較）
2. ✅ ファネル分析②（過去比較）
3. ✅ ブランドイメージ（過去比較）
4. ✅ ブランドパワー①（過去比較）
5. ✅ ブランドパワー②（過去比較）
6. ✅ アーキタイプ（過去比較）
7. 🚧 モード7-14（実装予定）

### 4. データ選択
- **詳細分析モード**: ブランド/セグメントを複数選択（最大10個）
- **過去比較モード**: データソースを最大3つ読み込み、ON/OFF切り替え

### 5. エクスポート
- **画像エクスポート**: グラフまたはグラフ+データをクリップボードにコピー
- **CSVエクスポート**: データをCSV形式でダウンロード

---

## 🧪 テスト

```bash
# ユニットテスト (今後実装予定)
npm test

# E2Eテスト (今後実装予定)
npm run test:e2e
```

---

## 📝 ドキュメント

### リファクタリング関連
- [リファクタリング完了レポート](./REFACTORING_COMPLETION_REPORT.md)
- [リファクタリング計画](./REFACTORING_PLAN.md)
- [リファクタリング実装ガイド](./REFACTORING_IMPLEMENTATION_GUIDE.md)
- [詳細実装計画](./docs/APP_REFACTORING_DETAIL.md)

### 過去比較モード実装（v3.0.0-beta）
- [📖 マスターガイド](./docs/HISTORICAL_MODES_MASTER_GUIDE.md) - 全体概要と実装パターン（必読）
- [📋 要件定義書](./docs/HISTORICAL_COMPARISON_REQUIREMENTS.md) - 全体要件
- [🔧 実装ガイド](./docs/HISTORICAL_MODES_IMPLEMENTATION_GUIDE.md) - 実装手順
- [📝 Mode 1-6実装報告書](./docs/) - 各モードの詳細（HISTORICAL_MODE*.md）

---

## 🤝 貢献

このプロジェクトへの貢献を歓迎します。

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

---

## 📄 ライセンス

このプロジェクトは私的利用のためのものです。

---

## 👤 作成者

AI Assistant

---

## 📅 更新履歴

### 2025-12-01 (v3.0.1-beta)
- **Excelパーサー改良: ブランドイメージ項目のパターンマッチング抽出**
  - ✅ 固定列範囲（41-174列）からパターンマッチング方式に変更
  - ✅ 行1（2行目）に「ブランドイメージ」を含む列を動的に検索
  - ✅ ファイルごとに列数が異なっても自動的に対応可能（例：202406ファイルは207列、202506ファイルは195列）
  - ✅ ヘッダ構造の活用（行0、行1、行2を活用）
  - ✅ 柔軟性と保守性の向上

### 2025-11-29 (v2.7.0)
- **アーキタイプ分析追加**
  - Mode 13: アーキタイプ分析（セグメント×ブランド）追加
  - Mode 14: アーキタイプ分析（ブランド×セグメント）追加
  - 12タイプのブランドパーソナリティ評価
  - ブランドイメージ項目から自動計算
  - レーダーチャートによる直感的な可視化
- **技術的改善**
  - アーキタイプ計算エンジンの実装
  - 型定義の拡張（ArchetypeMetrics）
  - 包括的なドキュメント作成

### 2025-11-29 (v2.6.0)
- **大規模リファクタリング完了**
  - App.tsxの行数を42%削減 (990行 → 575行)
  - 17個の専用モジュールを新規作成
  - カスタムフック導入による状態管理の改善
  - ExcelParserサービスの分離
  - 型定義の体系化
- **UI/UX改善**
  - ラベル表記の統一（「データシート」→「セグメント」など）
  - モード4・モード5の挙動修正
- **バグ修正**
  - LocalStorage互換性問題の解決
  - データ未定義時のクラッシュ防止

### 2025-11-30 (v3.0.0-beta)
- **過去比較モード Mode 1-6実装**
  - Mode 1: ファネル分析①（過去比較）
  - Mode 2: ファネル分析②（過去比較）
  - Mode 3: ブランドイメージ分析（過去比較）
  - Mode 4: ブランドパワー分析①（過去比較）
  - Mode 5: ブランドパワー分析②（過去比較）
  - Mode 6: アーキタイプ分析（過去比較）
- **グローバルモード切り替え機能**
  - 詳細分析 ⇔ 過去比較の切り替え
- **複数データソース管理機能**
  - 最大3ファイルの同時読み込み
  - データソースのON/OFF切り替え
  - データソース名の自動抽出・編集
  - 一括リセット機能
- **隠しコマンド**
  - Ctrl+Shift+ダブルクリックで3ファイル自動読み込み
- **UX改善**
  - データソース管理UIの追加
  - グローバルモードタブの追加
  - 基準データソース警告の表示

### 2025-11-30 (v2.10.0)
- **バグ修正**
  - `config`が`undefined`の場合のエラーハンドリングを改善
  - 無効な`analysisMode`の検出とフォールバック処理を追加
- **UI/UX改善**
  - Excelファイルを開くまでは分析モードと分析項目を無効化
  - 隠しコマンドをShift+クリックからShift+ダブルクリックに変更

### 以前
- 初版リリース
- 12種類の分析モード実装
- 基本機能実装

詳細な変更履歴は [docs/CHANGELOG.md](./docs/CHANGELOG.md) をご覧ください。
